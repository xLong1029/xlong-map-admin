import{gm as _,o4 as f,mj as O,mk as d,im as p,i as z,ij as g,aN as S,o5 as v,i9 as m,ak as y,o6 as G}from"./index.a33ecea7.js";import{y as o}from"./settings.3514c0cd.js";import{n as P}from"./LineVisualElement.ea11337b.js";function C(a,e,r,c,l){const t=_(3*a.length),u=_(t.length);a.forEach((s,h)=>{t[3*h+0]=s[0],t[3*h+1]=s[1],t[3*h+2]=s.length>2?s[2]:0});const n=f(t,e,0,u,0,t,0,t.length/3,r,c,l),i=n!=null;return{numVertices:a.length,position:t,mapPositions:u,projectionSuccess:i,sampledElevation:n}}class I extends P{constructor(e){super(e),this.view=null,this._renderOccluded=O.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=o.colorToVec4(o.reshapeManipulators.vertex.color),this._size=o.reshapeManipulators.vertex.size,this._outlineColor=o.colorToVec4(o.reshapeManipulators.vertex.outlineColor),this._outlineSize=o.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){d(e,this._color)||(p(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){d(e,this._outlineColor)||(p(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(z(e)||e.length===0)return[];const r=.5,c=.5,l=C(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,g.fromElevationInfo(this.elevationInfo)),t=[],u=l.numVertices,n=l.position;for(let i=0;i<u;++i){const s=S(E,n[3*i+0],n[3*i+1],n[3*i+2]),h=x(this._vertexMaterial,r,s),M=x(this._vertexOutlineMaterial,c,s);t.push({vertexGeometry:h,vertexOutlineGeometry:M})}return t}createGeometries(e){const r=this._createRenderGeometries();for(const{vertexGeometry:c,vertexOutlineGeometry:l}of r)e.addGeometry(c),e.addGeometry(l)}createExternalResources(){this._vertexMaterial=new v({...this._vertexMaterialParameters,writeDepth:!0,cullFace:m.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new v({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:m.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const E=y();function x(a,e,r){return G(a,e,16,16,{offset:r})}export{I as _};
