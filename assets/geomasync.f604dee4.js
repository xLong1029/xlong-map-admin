import{pf as w,uM as u,uN as l,ap as b,la as N,aR as O,v as x,s$ as E,fa as U,pG as tn,fD as rn}from"./index.a33ecea7.js";import{u as s,B as h,U as q,r as C,J as A,V as F,d as D,w as P,G as M,x as S,y as d,S as B,E as y,H as j,I as z,l as R,K as an,M as un,O as ln,P as H,b as k,Q as T,W as cn,X as Z}from"./arcadeUtils.9cf93f1c.js";import{disjoint as fn,intersects as on,touches as sn,crosses as dn,within as wn,contains as hn,overlaps as mn,equals as pn,relate as yn,intersect as gn,union as vn,difference as Pn,symmetricDifference as In,clip as An,cut as Fn,planarArea as G,geodesicArea as K,planarLength as J,geodesicLength as W,distance as Rn,densify as V,geodesicDensify as Q,generalize as Nn,buffer as xn,geodesicBuffer as bn,offset as Sn,rotate as X,simplify as Y,isSimple as On,convexHull as Dn}from"./geometryEngineAsync.b3e6729c.js";import{t as _,s as $}from"./portalUtils.6d18f907.js";import"./arcadeTimeUtils.fe70ea3d.js";import"./number.3a45a7bb.js";import"./hash.1de989e0.js";function nn(r){return tn.indexOf("4.")===0?x.fromExtent(r):new x({spatialReference:r.spatialReference,rings:[[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}function I(r,e,t){if(h(r,2,2,e,t),!(r[0]instanceof w&&r[1]instanceof w)){if(!(r[0]instanceof w&&r[1]===null)){if(!(r[1]instanceof w&&r[0]===null)){if(r[0]!==null||r[1]!==null)throw new u(e,l.InvalidParameter,t)}}}}async function en(r,e){if(r.type!=="polygon"&&r.type!=="polyline"&&r.type!=="extent")return 0;let t=1;(r.spatialReference.vcsWkid||r.spatialReference.latestVcsWkid)&&(t=cn(r.spatialReference)/rn(r.spatialReference));let c=0;if(r.type==="polyline")for(const n of r.paths)for(let a=1;a<n.length;a++)c+=Z(n[a],n[a-1],t);else if(r.type==="polygon")for(const n of r.rings){for(let a=1;a<n.length;a++)c+=Z(n[a],n[a-1],t);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(c+=Z(n[0],n[n.length-1],t))}else r.type==="extent"&&(c+=2*Z([r.xmin,r.ymin,0],[r.xmax,r.ymin,0],t),c+=2*Z([r.xmin,r.ymin,0],[r.xmin,r.ymax,0],t),c*=2,c+=4*Math.abs(d(r.zmax,0)*t-d(r.zmin,0)*t));const o=new N({hasZ:!1,hasM:!1,spatialReference:r.spatialReference,paths:[[0,0],[0,c]]});return J(o,e)}function kn(r){r.mode==="async"&&(r.functions.disjoint=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]===null||n[1]===null||fn(n[0],n[1])))},r.functions.intersects=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&on(n[0],n[1])))},r.functions.touches=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&sn(n[0],n[1])))},r.functions.crosses=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&dn(n[0],n[1])))},r.functions.within=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&wn(n[0],n[1])))},r.functions.contains=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&hn(n[0],n[1])))},r.functions.overlaps=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]!==null&&mn(n[0],n[1])))},r.functions.equals=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(h(n,2,2,e,t),n[0]===n[1]||(n[0]instanceof w&&n[1]instanceof w?pn(n[0],n[1]):!(!q(n[0])||!q(n[1]))&&n[0].equals(n[1]))))},r.functions.relate=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,3,3,e,t),n[0]instanceof w&&n[1]instanceof w)return yn(n[0],n[1],C(n[2]));if(n[0]instanceof w&&n[1]===null||n[1]instanceof w&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new u(e,l.InvalidParameter,t)})},r.functions.intersection=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]===null||n[1]===null?null:gn(n[0],n[1])))},r.functions.union=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{const a=[];if((n=s(n)).length===0)throw new u(e,l.WrongNumberOfParameters,t);if(n.length===1)if(A(n[0])){const i=s(n[0]);for(let f=0;f<i.length;f++)if(i[f]!==null){if(!(i[f]instanceof w))throw new u(e,l.InvalidParameter,t);a.push(i[f])}}else{if(!F(n[0])){if(n[0]instanceof w)return D(P(n[0]),e.spatialReference);if(n[0]===null)return null;throw new u(e,l.InvalidParameter,t)}{const i=s(n[0].toArray());for(let f=0;f<i.length;f++)if(i[f]!==null){if(!(i[f]instanceof w))throw new u(e,l.InvalidParameter,t);a.push(i[f])}}}else for(let i=0;i<n.length;i++)if(n[i]!==null){if(!(n[i]instanceof w))throw new u(e,l.InvalidParameter,t);a.push(n[i])}return a.length===0?null:vn(a)})},r.functions.difference=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:Pn(n[0],n[1])))},r.functions.symmetricdifference=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>(I(n=s(n),e,t),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):In(n[0],n[1])))},r.functions.clip=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,2,e,t),!(n[1]instanceof b)&&n[1]!==null)throw new u(e,l.InvalidParameter,t);if(n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return n[1]===null?null:An(n[0],n[1])})},r.functions.cut=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,2,e,t),!(n[1]instanceof N)&&n[1]!==null)throw new u(e,l.InvalidParameter,t);if(n[0]===null)return[];if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return n[1]===null?[P(n[0])]:Fn(n[0],n[1])})},r.functions.area=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{if(h(n,1,2,e,t),(n=s(n))[0]===null)return 0;if(M(n[0])){const a=await n[0].sumArea(S(d(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new u(e,l.Cancelled,t);return a}if(A(n[0])||F(n[0])){const a=B(n[0],e.spatialReference);return a===null?0:G(a,S(d(n[1],-1)))}if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return G(n[0],S(d(n[1],-1)))})},r.functions.areageodetic=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{if(h(n,1,2,e,t),(n=s(n))[0]===null)return 0;if(M(n[0])){const a=await n[0].sumArea(S(d(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new u(e,l.Cancelled,t);return a}if(A(n[0])||F(n[0])){const a=B(n[0],e.spatialReference);return a===null?0:K(a,S(d(n[1],-1)))}if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return K(n[0],S(d(n[1],-1)))})},r.functions.length=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{if(h(n,1,2,e,t),(n=s(n))[0]===null)return 0;if(M(n[0])){const a=await n[0].sumLength(y(d(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new u(e,l.Cancelled,t);return a}if(A(n[0])||F(n[0])){const a=j(n[0],e.spatialReference);return a===null?0:J(a,y(d(n[1],-1)))}if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return J(n[0],y(d(n[1],-1)))})},r.functions.length3d=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(h(n,1,2,e,t),(n=s(n))[0]===null)return 0;if(A(n[0])||F(n[0])){const a=j(n[0],e.spatialReference);return a===null?0:a.hasZ===!0?en(a,y(d(n[1],-1))):J(a,y(d(n[1],-1)))}if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return n[0].hasZ===!0?en(n[0],y(d(n[1],-1))):J(n[0],y(d(n[1],-1)))})},r.functions.lengthgeodetic=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{if(h(n,1,2,e,t),(n=s(n))[0]===null)return 0;if(M(n[0])){const a=await n[0].sumLength(y(d(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new u(e,l.Cancelled,t);return a}if(A(n[0])||F(n[0])){const a=j(n[0],e.spatialReference);return a===null?0:W(a,y(d(n[1],-1)))}if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return W(n[0],y(d(n[1],-1)))})},r.functions.distance=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{n=s(n),h(n,2,3,e,t);let a=n[0];(A(n[0])||F(n[0]))&&(a=z(n[0],e.spatialReference));let i=n[1];if((A(n[1])||F(n[1]))&&(i=z(n[1],e.spatialReference)),!(a instanceof w))throw new u(e,l.InvalidParameter,t);if(!(i instanceof w))throw new u(e,l.InvalidParameter,t);return Rn(a,i,y(d(n[2],-1)))})},r.functions.distancegeodetic=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{n=s(n),h(n,2,3,e,t);const a=n[0],i=n[1];if(!(a instanceof O))throw new u(e,l.InvalidParameter,t);if(!(i instanceof O))throw new u(e,l.InvalidParameter,t);const f=new N({paths:[],spatialReference:a.spatialReference});return f.addPath([a,i]),W(f,y(d(n[2],-1)))})},r.functions.densify=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);if(a<=0)throw new u(e,l.InvalidParameter,t);return n[0]instanceof x||n[0]instanceof N?V(n[0],a,y(d(n[2],-1))):n[0]instanceof b?V(nn(n[0]),a,y(d(n[2],-1))):n[0]})},r.functions.densifygeodetic=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);if(a<=0)throw new u(e,l.InvalidParameter,t);return n[0]instanceof x||n[0]instanceof N?Q(n[0],a,y(d(n[2],-1))):n[0]instanceof b?Q(nn(n[0]),a,y(d(n[2],-1))):n[0]})},r.functions.generalize=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,4,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);return Nn(n[0],a,an(d(n[2],!0)),y(d(n[3],-1)))})},r.functions.buffer=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);return a===0?P(n[0]):xn(n[0],a,y(d(n[2],-1)))})},r.functions.buffergeodetic=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);return a===0?P(n[0]):bn(n[0],a,y(d(n[2],-1)))})},r.functions.offset=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,2,6,e,t),n[0]===null)return null;if(!(n[0]instanceof x||n[0]instanceof N))throw new u(e,l.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new u(e,l.InvalidParameter,t);const i=R(d(n[4],10));if(isNaN(i))throw new u(e,l.InvalidParameter,t);const f=R(d(n[5],0));if(isNaN(f))throw new u(e,l.InvalidParameter,t);return Sn(n[0],a,y(d(n[2],-1)),C(d(n[3],"round")).toLowerCase(),i,f)})},r.functions.rotate=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{n=s(n),h(n,2,3,e,t);let a=n[0];if(a===null)return null;if(!(a instanceof w))throw new u(e,l.InvalidParameter,t);a instanceof b&&(a=x.fromExtent(a));const i=R(n[1]);if(isNaN(i))throw new u(e,l.InvalidParameter,t);const f=d(n[2],null);if(f===null)return X(a,i);if(f instanceof O)return X(a,i,f);throw new u(e,l.InvalidParameter,t)})},r.functions.centroid=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,1,1,e,t),n[0]===null)return null;let a=n[0];if((A(n[0])||F(n[0]))&&(a=z(n[0],e.spatialReference)),a===null)return null;if(!(a instanceof w))throw new u(e,l.InvalidParameter,t);return a instanceof O?D(P(n[0]),e.spatialReference):a instanceof x?a.centroid:a instanceof N?un(a):a instanceof E?ln(a):a instanceof b?a.center:null})},r.functions.multiparttosinglepart=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{n=s(n),h(n,1,1,e,t);const a=[];if(n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);if(n[0]instanceof O)return[D(P(n[0]),e.spatialReference)];if(n[0]instanceof b)return[D(P(n[0]),e.spatialReference)];const i=await Y(n[0]);if(i instanceof x){const f=[],p=[];for(let m=0;m<i.rings.length;m++)if(i.isClockwise(i.rings[m])){const g=U({rings:[i.rings[m]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});f.push(g)}else p.push({ring:i.rings[m],pt:i.getPoint(m,0)});for(let m=0;m<p.length;m++)for(let g=0;g<f.length;g++)if(f[g].contains(p[m].pt)){f[g].addRing(p[m].ring);break}return f}if(i instanceof N){const f=[];for(let p=0;p<i.paths.length;p++){const m=U({paths:[i.paths[p]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});f.push(m)}return f}if(n[0]instanceof E){const f=D(P(n[0]),e.spatialReference);for(let p=0;p<f.points.length;p++)a.push(f.getPoint(p));return a}return null})},r.functions.issimple=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,1,1,e,t),n[0]===null)return!0;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return On(n[0])})},r.functions.simplify=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return Y(n[0])})},r.functions.convexhull=function(e,t){return r.standardFunctionAsync(e,t,(c,o,n)=>{if(n=s(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof w))throw new u(e,l.InvalidParameter,t);return Dn(n[0])})},r.functions.getuser=function(e,t){return r.standardFunctionAsync(e,t,async(c,o,n)=>{h(n,0,2,e,t);let a=d(n[1],""),i=a===!0;if(a=a===!0||a===!1?"":C(a),n.length===0||n[0]instanceof H){let p=null;e.services&&e.services.portal&&(p=e.services.portal),n.length>0&&(p=_(n[0],p));const m=await $(p,a,i);if(m){const g=JSON.parse(JSON.stringify(m));for(const v of["lastLogin","created","modified"])g[v]!==void 0&&g[v]!==null&&(g[v]=new Date(g[v]));return k.convertObjectToArcadeDictionary(g,T(e))}return null}let f=null;if(M(n[0])&&(f=n[0]),f){if(i=!1,a)return null;await f.load();const p=await f.getOwningSystemUrl();if(!p){if(!a){const v=await f.getIdentityUser();return v?k.convertObjectToArcadeDictionary({username:v},T(e)):null}return null}let m=null;e.services&&e.services.portal&&(m=e.services.portal),m=_(new H(p),m);const g=await $(m,a,i);if(g){const v=JSON.parse(JSON.stringify(g));for(const L of["lastLogin","created","modified"])v[L]!==void 0&&v[L]!==null&&(v[L]=new Date(v[L]));return k.convertObjectToArcadeDictionary(v,T(e))}return null}throw new u(e,l.InvalidParameter,t)})})}export{kn as registerFunctions};
