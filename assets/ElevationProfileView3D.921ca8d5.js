import{cm as D,aC as v,i as m,co as P,a4 as H,ws as L,oK as b,mj as k,w as d,kp as G,gM as I,r as E,e as _,y as f,b as V,d as x,t as $,cI as M,G as p,i5 as O,l as S,ad as T,la as z,xP as C,eN as w,a as u,xN as y}from"./index.a33ecea7.js";import{p as j}from"./HoveredPoints.9d8ce449.js";import{y as A}from"./settings.3514c0cd.js";import{I as R,e as N}from"./GraphicState.ca18c216.js";class B{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=D(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),m(e)||!g(e))return;const s=e.layer;this._highlightTask=P(async t=>{const n=await this._params.view.whenLayerView(s);H(t),L(n)&&(this._highlightHandle=n.highlight(e))})}showReshaping(e){if(this.remove(),m(e))return;const s=this._params.view,t=new R({view:s,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:b(e),renderOccluded:k.OccludeAndTransparentStencil}),n=new N({graphic:e}),i=[d(()=>n.isDraped,l=>{t.isDraped=l}),n.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),s.trackGraphicState(n),s.maskOccludee(e),G(t)];A.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=I(i)}}function g(a){return E(a.geometry)&&a.geometry.type==="polyline"}const K=100;let c=class extends x{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new $}initialize(){const a=M(e=>{this._update(e)},K);this._handles.add([d(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,p),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(m(e))return this.remove();if(!e.refined)return;const s=this._visualElements,t=e.lines.filter(h=>h.viewVisualizationEnabled),n=t.length;for(;s.length>n;)s.pop().destroy();const i=C().profileLinesStyle3D;for(;s.length<n;){const h=new R({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});s.push(h)}const l=a.spatialReference;for(let h=0;h<n;++h){const o=s[h],r=t[n-1-h];o.geometry=this._createLineGeometry(r,l),o.innerColor=O(S.toUnitRGBA(r.color))}}_createLineGeometry(a,e){const s=T(a.samples,[]),t=s.length-1,n=[];let i=[];for(let l=0;l<=t;l++){const{x:h,y:o,z:r}=s[l];E(r)&&i.push([h,o,r]),(l===t||m(r))&&i.length&&(n.push(i),i=[])}return new z({paths:n,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};_([f()],c.prototype,"view",void 0),_([f()],c.prototype,"_chartData",void 0),c=_([V("esri.widgets.ElevationProfile.support.ProfileLines3D")],c);class F{constructor(e,s){this._handles=new $,this._inputRepresentation=new B({view:e}),this._hoveredPoints=new j({view:e}),this._profileLines=new c({view:e}),this._handles.add([d(()=>s.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),p),d(()=>{const{state:t,editable:n,highlightEnabled:i,viewModel:l}=s,h=l.input;return w(h,o=>{o.commitProperty("geometry"),o.commitProperty("layer")}),{input:h,state:t,editable:n,highlightEnabled:i}},t=>this._updateInputRepresentation(t),p),d(()=>s.viewModel.chartData,t=>this._profileLines.update(t),p),d(()=>w(s.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},p)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:e,state:s,editable:t,highlightEnabled:n}){const i=this._inputRepresentation;if(!n)return i.remove();s===y.Selected?i.showHighlight(e):s!==y.Created||t?i.remove():i.showReshaping(e)}}export{F as ElevationProfileView3D};
