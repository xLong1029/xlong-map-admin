var _t=Object.defineProperty,Nt=Object.defineProperties;var Vt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Ft=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var rt=(e,t,r)=>t in e?_t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t)=>{for(var r in t||(t={}))Ft.call(t,r)&&rt(e,r,t[r]);if(tt)for(var r of tt(t))$t.call(t,r)&&rt(e,r,t[r]);return e},pe=(e,t)=>Nt(e,Vt(t));import{c5 as ce,cZ as jt,cY as zt,aY as F,aZ as j,aq as Yt,a_ as Ve,fT as Fe,bS as ot,ar as Kt,b1 as oe,b2 as it,bF as Wt,cp as ke}from"./vendor.47ccae81.js";import{u as le,i as Ue,l as nt,c as $e,r as je,x as Ht,p as at,f as st,o as Pe,a as lt,s as Jt}from"./pixelUtils.b67e8c28.js";import{r as qt}from"./LercCodec.049cf1fe.js";import{p as Xt,z as ft,y as Zt}from"./colorUtils.92e1b957.js";var ze,ut,ct,ht={exports:{}};ut=ht,ze=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,s=r?r.byteLength:0;if(t<s)return r;for(var o=512;o<t;)o<<=1;for(var a=new Uint8Array(o),f=0;f<s;++f)a[f]=r[f];return this.buffer=a},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var s=r+t;!this.eof&&this.bufferLength<s;)this.readBlock();var o=this.bufferLength;s>o&&(s=o)}else{for(;!this.eof;)this.readBlock();s=this.bufferLength}return this.pos=s,this.buffer.subarray(r,s)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,s){for(var o=t+r;this.bufferLength<=o&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,s)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(ct=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),s=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function a(n){throw new Error(n)}function f(n){var i=0,l=n[i++],u=n[i++];l!=-1&&u!=-1||a("Invalid header in flate stream"),(15&l)!=8&&a("Unknown compression method in flate stream"),((l<<8)+u)%31!=0&&a("Bad FCHECK in flate stream"),32&u&&a("FDICT bit set in flate stream"),this.bytes=n,this.bytesPos=i,this.codeSize=0,this.codeBuf=0,ze.call(this)}return f.prototype=Object.create(ze.prototype),f.prototype.getBits=function(n){for(var i,l=this.codeSize,u=this.codeBuf,c=this.bytes,h=this.bytesPos;l<n;)(i=c[h++])===void 0&&a("Bad encoding in flate stream"),u|=i<<l,l+=8;return i=u&(1<<n)-1,this.codeBuf=u>>n,this.codeSize=l-=n,this.bytesPos=h,i},f.prototype.getCode=function(n){for(var i=n[0],l=n[1],u=this.codeSize,c=this.codeBuf,h=this.bytes,y=this.bytesPos;u<l;){var w;(w=h[y++])===void 0&&a("Bad encoding in flate stream"),c|=w<<u,u+=8}var m=i[c&(1<<l)-1],b=m>>16,d=65535&m;return(u==0||u<b||b==0)&&a("Bad encoding in flate stream"),this.codeBuf=c>>b,this.codeSize=u-b,this.bytesPos=y,d},f.prototype.generateHuffmanTable=function(n){for(var i=n.length,l=0,u=0;u<i;++u)n[u]>l&&(l=n[u]);for(var c=1<<l,h=new Uint32Array(c),y=1,w=0,m=2;y<=l;++y,w<<=1,m<<=1)for(var b=0;b<i;++b)if(n[b]==y){var d=0,g=w;for(u=0;u<y;++u)d=d<<1|1&g,g>>=1;for(u=d;u<c;u+=m)h[u]=y<<16|b;++w}return[h,l]},f.prototype.readBlock=function(){function n(U,O,G,_,V){for(var H=U.getBits(G)+_;H-- >0;)O[m++]=V}var i=this.getBits(3);if(1&i&&(this.eof=!0),(i>>=1)!=0){var l,u;if(i==1)l=s,u=o;else if(i==2){for(var c=this.getBits(5)+257,h=this.getBits(5)+1,y=this.getBits(4)+4,w=Array(e.length),m=0;m<y;)w[e[m++]]=this.getBits(3);for(var b=this.generateHuffmanTable(w),d=0,g=(m=0,c+h),T=new Array(g);m<g;){var S=this.getCode(b);S==16?n(this,T,2,3,d):S==17?n(this,T,3,3,d=0):S==18?n(this,T,7,11,d=0):T[m++]=d=S}l=this.generateHuffmanTable(T.slice(0,c)),u=this.generateHuffmanTable(T.slice(c,g))}else a("Unknown block type in flate stream");for(var p=(R=this.buffer)?R.length:0,v=this.bufferLength;;){var C=this.getCode(l);if(C<256)v+1>=p&&(p=(R=this.ensureBuffer(v+1)).length),R[v++]=C;else{if(C==256)return void(this.bufferLength=v);var k=(C=t[C-=257])>>16;k>0&&(k=this.getBits(k)),d=(65535&C)+k,C=this.getCode(u),(k=(C=r[C])>>16)>0&&(k=this.getBits(k));var I=(65535&C)+k;v+d>=p&&(p=(R=this.ensureBuffer(v+d)).length);for(var P=0;P<d;++P,++v)R[v]=R[v-I]}}}else{var x,L=this.bytes,A=this.bytesPos;(x=L[A++])===void 0&&a("Bad block header in flate stream");var D=x;(x=L[A++])===void 0&&a("Bad block header in flate stream"),D|=x<<8,(x=L[A++])===void 0&&a("Bad block header in flate stream");var M=x;(x=L[A++])===void 0&&a("Bad block header in flate stream"),(M|=x<<8)!=(65535&~D)&&a("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var E=this.bufferLength,R=this.ensureBuffer(E+D),N=E+D;this.bufferLength=N;for(var z=E;z<N;++z){if((x=L[A++])===void 0){this.eof=!0;break}R[z]=x}this.bytesPos=A}},f}())!==void 0&&(ut.exports=ct);const ve=ht.exports;class Ye{constructor(t){t&&(this.canvas=t.canvas,this.ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,s){if(!t||t.byteLength<10)throw new ce("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:o,height:a,format:f}=r;const{applyJpegMask:n}=r;if(n&&(!o||!a))throw new ce("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((i,l)=>{let u=null;f==="jpg"&&n&&(u=Ye.getMask(t,{width:o,height:a}));const c=new Blob([new Uint8Array(t)],{type:"image/"+f=="jpg"?"jpeg":f}),h=URL.createObjectURL(c),y=new Image;let w;y.src=h,y.onload=()=>{if(URL.revokeObjectURL(h),jt(s))return void l(zt());o=y.width,a=y.height,this.canvas?(this.canvas.width===o&&this.canvas.height===a||(this.canvas.width=o,this.canvas.height=a),this.ctx.clearRect(0,0,o,a)):(this.canvas=document.createElement("canvas"),this.canvas.width=o,this.canvas.height=a,this.ctx=this.canvas.getContext("2d")),this.ctx.drawImage(y,0,0);const m=this.ctx.getImageData(0,0,o,a);let b;if(w=m.data,r.renderOnCanvas){if(u)for(b=0;b<u.length;b++)u[b]?w[4*b+3]=255:w[4*b+3]=0;return this.ctx.putImageData(m,0,0),void i(null)}const d=o*a,g=new Uint8Array(d),T=new Uint8Array(d),S=new Uint8Array(d);if(u)for(b=0;b<d;b++)g[b]=w[4*b],T[b]=w[4*b+1],S[b]=w[4*b+2];else for(u=new Uint8Array(d),b=0;b<d;b++)g[b]=w[4*b],T[b]=w[4*b+1],S[b]=w[4*b+2],u[b]=w[4*b+3];i({width:o,height:a,pixels:[g,T,S],mask:u,pixelType:"u8"})},y.onerror=()=>{URL.revokeObjectURL(h),l("cannot load image")}})}static getMask(t,r){let s=null;try{const o=new Uint8Array(t),a=Math.ceil(o.length/2);let f=0;const n=o.length-2;for(f=a;f<n&&(o[f]!==255||o[f+1]!==217);f++);if(f+=2,f<o.length-1){const i=new ve(o.subarray(f)).getBytes();s=new Uint8Array(r.width*r.height);let l=0;for(let u=0;u<i.length;u++)for(let c=7;c>=0;c--)s[l++]=i[u]>>c&1}}catch{}return s}}var dt,pt,mt,gt={exports:{}};dt=gt,pt=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,s=799,o=3406,a=2276,f=1567,n=3784,i=5793,l=2896;function u(){this.decodeTransform=null,this.colorTransform=-1}function c(d,g){for(var T,S,p=0,v=[],C=16;C>0&&!d[C-1];)C--;v.push({children:[],index:0});var k,I=v[0];for(T=0;T<C;T++){for(S=0;S<d[T];S++){for((I=v.pop()).children[I.index]=g[p];I.index>0;)I=v.pop();for(I.index++,v.push(I);v.length<=T;)v.push(k={children:[],index:0}),I.children[I.index]=k.children,I=k;p++}T+1<C&&(v.push(k={children:[],index:0}),I.children[I.index]=k.children,I=k)}return v[0].children}function h(d,g,T){return 64*((d.blocksPerLine+1)*g+T)}function y(d,g,T,S,p,v,C,k,I){var P=T.mcusPerLine,x=T.progressive,L=g,A=0,D=0;function M(){if(D>0)return D--,A>>D&1;if((A=d[g++])===255){var B=d[g++];if(B)throw new e("unexpected marker "+(A<<8|B).toString(16))}return D=7,A>>>7}function E(B){for(var $=B;;){if(typeof($=$[M()])=="number")return $;if(typeof $!="object")throw new e("invalid huffman sequence")}}function R(B){for(var $=0;B>0;)$=$<<1|M(),B--;return $}function N(B){if(B===1)return M()===1?1:-1;var $=R(B);return $>=1<<B-1?$:$+(-1<<B)+1}function z(B,$){var K=E(B.huffmanTableDC),Z=K===0?0:N(K);B.blockData[$]=B.pred+=Z;for(var re=1;re<64;){var ue=E(B.huffmanTableAC),Q=15&ue,ie=ue>>4;if(Q!==0){var Gt=t[re+=ie];B.blockData[$+Gt]=N(Q),re++}else{if(ie<15)break;re+=16}}}function U(B,$){var K=E(B.huffmanTableDC),Z=K===0?0:N(K)<<I;B.blockData[$]=B.pred+=Z}function O(B,$){B.blockData[$]|=M()<<I}var G=0;function _(B,$){if(G>0)G--;else for(var K=v,Z=C;K<=Z;){var re=E(B.huffmanTableAC),ue=15&re,Q=re>>4;if(ue!==0){var ie=t[K+=Q];B.blockData[$+ie]=N(ue)*(1<<I),K++}else{if(Q<15){G=R(Q)+(1<<Q)-1;break}K+=16}}}var V,H=0;function X(B,$){for(var K,Z,re=v,ue=C,Q=0;re<=ue;){var ie=t[re];switch(H){case 0:if(Q=(Z=E(B.huffmanTableAC))>>4,(K=15&Z)==0)Q<15?(G=R(Q)+(1<<Q),H=4):(Q=16,H=1);else{if(K!==1)throw new e("invalid ACn encoding");V=N(K),H=Q?2:3}continue;case 1:case 2:B.blockData[$+ie]?B.blockData[$+ie]+=M()<<I:--Q==0&&(H=H===2?3:0);break;case 3:B.blockData[$+ie]?B.blockData[$+ie]+=M()<<I:(B.blockData[$+ie]=V<<I,H=0);break;case 4:B.blockData[$+ie]&&(B.blockData[$+ie]+=M()<<I)}re++}H===4&&--G==0&&(H=0)}function ee(B,$,K,Z,re){var ue=K%P;$(B,h(B,(K/P|0)*B.v+Z,ue*B.h+re))}function Se(B,$,K){$(B,h(B,K/B.blocksPerLine|0,K%B.blocksPerLine))}var ae,fe,he,ge,W,De,ye=S.length;De=x?v===0?k===0?U:O:k===0?_:X:z;var se,we,Le,Ee,de=0;for(we=ye===1?S[0].blocksPerLine*S[0].blocksPerColumn:P*T.mcusPerColumn;de<we;){var Re=p?Math.min(we-de,p):we;for(fe=0;fe<ye;fe++)S[fe].pred=0;if(G=0,ye===1)for(ae=S[0],W=0;W<Re;W++)Se(ae,De,de),de++;else for(W=0;W<Re;W++){for(fe=0;fe<ye;fe++)for(Le=(ae=S[fe]).h,Ee=ae.v,he=0;he<Ee;he++)for(ge=0;ge<Le;ge++)ee(ae,De,de,he,ge);de++}D=0,(se=b(d,g))&&se.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+se.invalid),g=se.offset);var Ce=se&&se.marker;if(!Ce||Ce<=65280)throw new e("marker was not found");if(!(Ce>=65488&&Ce<=65495))break;g+=2}return(se=b(d,g))&&se.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+se.invalid),g=se.offset),g-L}function w(d,g,T){var S,p,v,C,k,I,P,x,L,A,D,M,E,R,N,z,U,O=d.quantizationTable,G=d.blockData;if(!O)throw new e("missing required Quantization Table.");for(var _=0;_<64;_+=8)L=G[g+_],A=G[g+_+1],D=G[g+_+2],M=G[g+_+3],E=G[g+_+4],R=G[g+_+5],N=G[g+_+6],z=G[g+_+7],L*=O[_],(A|D|M|E|R|N|z)!=0?(A*=O[_+1],D*=O[_+2],M*=O[_+3],E*=O[_+4],R*=O[_+5],N*=O[_+6],z*=O[_+7],p=(S=(S=i*L+128>>8)+(p=i*E+128>>8)+1>>1)-p,U=(v=D)*n+(C=N)*f+128>>8,v=v*f-C*n+128>>8,P=(k=(k=l*(A-z)+128>>8)+(P=R<<4)+1>>1)-P,I=(x=(x=l*(A+z)+128>>8)+(I=M<<4)+1>>1)-I,C=(S=S+(C=U)+1>>1)-C,v=(p=p+v+1>>1)-v,U=k*a+x*o+2048>>12,k=k*o-x*a+2048>>12,x=U,U=I*s+P*r+2048>>12,I=I*r-P*s+2048>>12,P=U,T[_]=S+x,T[_+7]=S-x,T[_+1]=p+P,T[_+6]=p-P,T[_+2]=v+I,T[_+5]=v-I,T[_+3]=C+k,T[_+4]=C-k):(U=i*L+512>>10,T[_]=U,T[_+1]=U,T[_+2]=U,T[_+3]=U,T[_+4]=U,T[_+5]=U,T[_+6]=U,T[_+7]=U);for(var V=0;V<8;++V)L=T[V],((A=T[V+8])|(D=T[V+16])|(M=T[V+24])|(E=T[V+32])|(R=T[V+40])|(N=T[V+48])|(z=T[V+56]))!=0?(p=(S=4112+((S=i*L+2048>>12)+(p=i*E+2048>>12)+1>>1))-p,U=(v=D)*n+(C=N)*f+2048>>12,v=v*f-C*n+2048>>12,C=U,P=(k=(k=l*(A-z)+2048>>12)+(P=R)+1>>1)-P,I=(x=(x=l*(A+z)+2048>>12)+(I=M)+1>>1)-I,U=k*a+x*o+2048>>12,k=k*o-x*a+2048>>12,x=U,U=I*s+P*r+2048>>12,I=I*r-P*s+2048>>12,L=(L=(S=S+C+1>>1)+x)<16?0:L>=4080?255:L>>4,A=(A=(p=p+v+1>>1)+(P=U))<16?0:A>=4080?255:A>>4,D=(D=(v=p-v)+I)<16?0:D>=4080?255:D>>4,M=(M=(C=S-C)+k)<16?0:M>=4080?255:M>>4,E=(E=C-k)<16?0:E>=4080?255:E>>4,R=(R=v-I)<16?0:R>=4080?255:R>>4,N=(N=p-P)<16?0:N>=4080?255:N>>4,z=(z=S-x)<16?0:z>=4080?255:z>>4,G[g+V]=L,G[g+V+8]=A,G[g+V+16]=D,G[g+V+24]=M,G[g+V+32]=E,G[g+V+40]=R,G[g+V+48]=N,G[g+V+56]=z):(U=(U=i*L+8192>>14)<-2040?0:U>=2024?255:U+2056>>4,G[g+V]=U,G[g+V+8]=U,G[g+V+16]=U,G[g+V+24]=U,G[g+V+32]=U,G[g+V+40]=U,G[g+V+48]=U,G[g+V+56]=U)}function m(d,g){for(var T=g.blocksPerLine,S=g.blocksPerColumn,p=new Int16Array(64),v=0;v<S;v++)for(var C=0;C<T;C++)w(g,h(g,v,C),p);return g.blockData}function b(d,g,T){function S(I){return d[I]<<8|d[I+1]}var p=d.length-1,v=T<g?T:g;if(g>=p)return null;var C=S(g);if(C>=65472&&C<=65534)return{invalid:null,marker:C,offset:g};for(var k=S(v);!(k>=65472&&k<=65534);){if(++v>=p)return null;k=S(v)}return{invalid:C.toString(16),marker:k,offset:v}}return u.prototype={parse:function(d){function g(){var B=d[C]<<8|d[C+1];return C+=2,B}function T(){var B=g(),$=C+B-2,K=b(d,$,C);K&&K.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+K.invalid),$=K.offset);var Z=d.subarray(C,$);return C+=Z.length,Z}function S(B){for(var $=Math.ceil(B.samplesPerLine/8/B.maxH),K=Math.ceil(B.scanLines/8/B.maxV),Z=0;Z<B.components.length;Z++){W=B.components[Z];var re=Math.ceil(Math.ceil(B.samplesPerLine/8)*W.h/B.maxH),ue=Math.ceil(Math.ceil(B.scanLines/8)*W.v/B.maxV),Q=$*W.h,ie=K*W.v*64*(Q+1);W.blockData=new Int16Array(ie),W.blocksPerLine=re,W.blocksPerColumn=ue}B.mcusPerLine=$,B.mcusPerColumn=K}var p,v,C=0,k=null,I=null,P=[],x=[],L=[],A=g();if(A!==65496)throw new e("SOI not found");for(A=g();A!==65497;){var D,M,E;switch(A){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var R=T();A===65504&&R[0]===74&&R[1]===70&&R[2]===73&&R[3]===70&&R[4]===0&&(k={version:{major:R[5],minor:R[6]},densityUnits:R[7],xDensity:R[8]<<8|R[9],yDensity:R[10]<<8|R[11],thumbWidth:R[12],thumbHeight:R[13],thumbData:R.subarray(14,14+3*R[12]*R[13])}),A===65518&&R[0]===65&&R[1]===100&&R[2]===111&&R[3]===98&&R[4]===101&&(I={version:R[5]<<8|R[6],flags0:R[7]<<8|R[8],flags1:R[9]<<8|R[10],transformCode:R[11]});break;case 65499:for(var N=g()+C-2;C<N;){var z=d[C++],U=new Uint16Array(64);if(z>>4==0)for(M=0;M<64;M++)U[t[M]]=d[C++];else{if(z>>4!=1)throw new e("DQT - invalid table spec");for(M=0;M<64;M++)U[t[M]]=g()}P[15&z]=U}break;case 65472:case 65473:case 65474:if(p)throw new e("Only single frame JPEGs supported");g(),(p={}).extended=A===65473,p.progressive=A===65474,p.precision=d[C++],p.scanLines=g(),p.samplesPerLine=g(),p.components=[],p.componentIds={};var O,G=d[C++],_=0,V=0;for(D=0;D<G;D++){O=d[C];var H=d[C+1]>>4,X=15&d[C+1];_<H&&(_=H),V<X&&(V=X);var ee=d[C+2];E=p.components.push({h:H,v:X,quantizationId:ee,quantizationTable:null}),p.componentIds[O]=E-1,C+=3}p.maxH=_,p.maxV=V,S(p);break;case 65476:var Se=g();for(D=2;D<Se;){var ae=d[C++],fe=new Uint8Array(16),he=0;for(M=0;M<16;M++,C++)he+=fe[M]=d[C];var ge=new Uint8Array(he);for(M=0;M<he;M++,C++)ge[M]=d[C];D+=17+he,(ae>>4==0?L:x)[15&ae]=c(fe,ge)}break;case 65501:g(),v=g();break;case 65498:g();var W,De=d[C++],ye=[];for(D=0;D<De;D++){var se=p.componentIds[d[C++]];W=p.components[se];var we=d[C++];W.huffmanTableDC=L[we>>4],W.huffmanTableAC=x[15&we],ye.push(W)}var Le=d[C++],Ee=d[C++],de=d[C++],Re=y(d,C,p,ye,v,Le,Ee,de>>4,15&de);C+=Re;break;case 65535:d[C]!==255&&C--;break;default:if(d[C-3]===255&&d[C-2]>=192&&d[C-2]<=254){C-=3;break}throw new e("unknown marker "+A.toString(16))}A=g()}for(this.width=p.samplesPerLine,this.height=p.scanLines,this.jfif=k,this.eof=C,this.adobe=I,this.components=[],D=0;D<p.components.length;D++){var Ce=P[(W=p.components[D]).quantizationId];Ce&&(W.quantizationTable=Ce),this.components.push({output:m(p,W),scaleX:W.h/p.maxH,scaleY:W.v/p.maxV,blocksPerLine:W.blocksPerLine,blocksPerColumn:W.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(d,g){var T,S,p,v,C,k,I,P,x,L,A,D=this.width/d,M=this.height/g,E=0,R=this.components.length,N=d*g*R,z=new Uint8ClampedArray(N),U=new Uint32Array(d),O=4294967288;for(I=0;I<R;I++){for(S=(T=this.components[I]).scaleX*D,p=T.scaleY*M,E=I,A=T.output,v=T.blocksPerLine+1<<3,C=0;C<d;C++)P=0|C*S,U[C]=(P&O)<<3|7&P;for(k=0;k<g;k++)for(L=v*((P=0|k*p)&O)|(7&P)<<3,C=0;C<d;C++)z[E]=A[L+U[C]],E+=R}var G=this.decodeTransform;if(G)for(I=0;I<N;)for(P=0,x=0;P<R;P++,I++,x+=2)z[I]=(z[I]*G[x]>>8)+G[x+1];return z},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(d){for(var g,T,S,p=0,v=d.length;p<v;p+=3)g=d[p],T=d[p+1],S=d[p+2],d[p]=g-179.456+1.402*S,d[p+1]=g+135.459-.344*T-.714*S,d[p+2]=g-226.816+1.772*T;return d},_convertYcckToRgb:function(d){for(var g,T,S,p,v=0,C=0,k=d.length;C<k;C+=4)g=d[C],T=d[C+1],S=d[C+2],p=d[C+3],d[v++]=T*(-660635669420364e-19*T+.000437130475926232*S-54080610064599e-18*g+.00048449797120281*p-.154362151871126)-122.67195406894+S*(-.000957964378445773*S+.000817076911346625*g-.00477271405408747*p+1.53380253221734)+g*(.000961250184130688*g-.00266257332283933*p+.48357088451265)+p*(-.000336197177618394*p+.484791561490776),d[v++]=107.268039397724+T*(219927104525741e-19*T-.000640992018297945*S+.000659397001245577*g+.000426105652938837*p-.176491792462875)+S*(-.000778269941513683*S+.00130872261408275*g+.000770482631801132*p-.151051492775562)+g*(.00126935368114843*g-.00265090189010898*p+.25802910206845)+p*(-.000318913117588328*p-.213742400323665),d[v++]=T*(-.000570115196973677*T-263409051004589e-19*S+.0020741088115012*g-.00288260236853442*p+.814272968359295)-20.810012546947+S*(-153496057440975e-19*S-.000132689043961446*g+.000560833691242812*p-.195152027534049)+g*(.00174418132927582*g-.00255243321439347*p+.116935020465145)+p*(-.000343531996510555*p+.24165260232407);return d},_convertYcckToCmyk:function(d){for(var g,T,S,p=0,v=d.length;p<v;p+=4)g=d[p],T=d[p+1],S=d[p+2],d[p]=434.456-g-1.402*S,d[p+1]=119.541-g+.344*T+.714*S,d[p+2]=481.816-g-1.772*T;return d},_convertCmykToRgb:function(d){for(var g,T,S,p,v=0,C=1/255,k=0,I=d.length;k<I;k+=4)g=d[k]*C,T=d[k+1]*C,S=d[k+2]*C,p=d[k+3]*C,d[v++]=255+g*(-4.387332384609988*g+54.48615194189176*T+18.82290502165302*S+212.25662451639585*p-285.2331026137004)+T*(1.7149763477362134*T-5.6096736904047315*S-17.873870861415444*p-5.497006427196366)+S*(-2.5217340131683033*S-21.248923337353073*p+17.5119270841813)-p*(21.86122147463605*p+189.48180835922747),d[v++]=255+g*(8.841041422036149*g+60.118027045597366*T+6.871425592049007*S+31.159100130055922*p-79.2970844816548)+T*(-15.310361306967817*T+17.575251261109482*S+131.35250912493976*p-190.9453302588951)+S*(4.444339102852739*S+9.8632861493405*p-24.86741582555878)-p*(20.737325471181034*p+187.80453709719578),d[v++]=255+g*(.8842522430003296*g+8.078677503112928*T+30.89978309703729*S-.23883238689178934*p-14.183576799673286)+T*(10.49593273432072*T+63.02378494754052*S+50.606957656360734*p-112.23884253719248)+S*(.03296041114873217*S+115.60384449646641*p-193.58209356861505)-p*(22.33816807309886*p+180.12613974708367);return d},getData:function(d,g,T){if(this.numComponents>4)throw new e("Unsupported color mode");var S=this._getLinearizedBlockData(d,g);if(this.numComponents===1&&T){for(var p=S.length,v=new Uint8ClampedArray(3*p),C=0,k=0;k<p;k++){var I=S[k];v[C++]=I,v[C++]=I,v[C++]=I}return v}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(S);if(this.numComponents===4){if(this._isColorConversionNeeded())return T?this._convertYcckToRgb(S):this._convertYcckToCmyk(S);if(T)return this._convertCmykToRgb(S)}return S}},u}()},(mt=pt())!==void 0&&(dt.exports=mt);const Me=gt.exports;class Qt{static decode(t){const r=new Uint8Array(t),s=new Me;s.parse(r);const{width:o,height:a,numComponents:f,eof:n}=s,i=s.getData(o,a,!0);let l;const u=o*a;let c=0,h=0,y=0;if(n<r.length-1){const b=new ve(r.subarray(n)).getBytes();l=new Uint8Array(u);let d=0;for(c=0;c<b.length;c++)for(y=7;y>=0;y--)l[d++]=b[c]>>y&1}let w,m=null;if(f===1)m=[i,i,i];else{for(m=[],c=0;c<3;c++)w=new Uint8Array(u),m.push(w);for(y=0,h=0;h<u;h++)for(c=0;c<3;c++)m[c][h]=i[y++]}return{width:o,height:a,pixels:m,mask:l}}}function er(e,t){let r=0,s="",o=0,a=0;const f=e.length;for(;r<f;)a=e[r++],o=a>>4,o<8?o=1:o===15?(o=4,a=(7&a)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):o===14?(o=3,a=(15&a)<<12|(63&e[r++])<<6|63&e[r++]):(o=2,a=(31&a)<<6|63&e[r++]),(a!==0||t)&&(s+=String.fromCharCode(a));return s}function tr(e,t,r,s=!0){if(t%4!=0||r%4!=0){const o=new ArrayBuffer(4*Math.ceil(r/4)),a=new Uint8Array(o),f=new Uint8Array(e,t,r);if(s)for(let n=0;n<a.length;n+=4)a[n]=f[n+3],a[n+1]=f[n+2],a[n+2]=f[n+1],a[n+3]=f[n];else a.set(f);return new Uint32Array(a.buffer)}if(s){const o=new Uint8Array(e,t,r),a=new Uint8Array(o.length);for(let f=0;f<a.length;f+=4)a[f]=o[f+3],a[f+1]=o[f+2],a[f+2]=o[f+1],a[f+3]=o[f];return new Uint32Array(a.buffer)}return new Uint32Array(e,t,r/4)}function yt(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function wt(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const Ie=new Set;function Ke(e,t,r,s=!0){const o=tr(e,t,r,s);let a=9,f=yt(),n=32,i=f.length,l=[],u=1,c=o[0],h=0;const y=o.length,w=8*(4*y-r),m=[];for(;c!=null;){if(n>=a)n-=a,h=c>>>32-a,c<<=a;else{h=c>>>32-n,c=o[u++];const d=a-n;n=32-d,h=(h<<d)+(c>>>n),c<<=d}if(h===257)break;if(h===256){a=9,f=yt(),i=f.length,l=[];continue}const b=f[h];if(b==null){if(h>f.length)throw"data integrity issue: code does not exist on code page";l.push(l[0]),f[i++]=l.slice(),wt(m,l)}else wt(m,b),l.push(b[0]),l.length>1&&(f[i++]=l.slice()),l=b.slice();if(Ie.has(i)&&a++,n===0&&(c=o[u++],n=32),u>y||u===y&&n<=w)break}return new Uint8Array(m)}Ie.add(511),Ie.add(1023),Ie.add(2047),Ie.add(4095),Ie.add(8191);const We=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),rr=(()=>{const e=[].concat(We);return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),or=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],ir=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),nr=function(e,t){let r=(t||We)[e];return r===void 0&&(r="unknown"+String(e)),r},He=new Map;He.set("EXIFIFD",rr),He.set("GPSIFD",or);const xe={TIFF_TAGS:We,ifdTags:He,GEO_KEYS:ir,getTagName:nr},Oe=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})();var me,J,Be,Ct,vt,bt={exports:{}};Ct=bt,me={unstuff:function(e,t,r,s,o,a,f,n){var i,l,u,c,h,y=(1<<r)-1,w=0,m=0,b=4*e.length-Math.ceil(r*s/8);if(e[e.length-1]<<=8*b,o)for(i=0;i<s;i++)m===0&&(u=e[w++],m=32),m>=r?(l=u>>>m-r&y,m-=r):(l=(u&y)<<(c=r-m)&y,l+=(u=e[w++])>>>(m=32-c)),t[i]=o[l];else for(h=Math.ceil((n-a)/f),i=0;i<s;i++)m===0&&(u=e[w++],m=32),m>=r?(l=u>>>m-r&y,m-=r):(l=(u&y)<<(c=r-m)&y,l+=(u=e[w++])>>>(m=32-c)),t[i]=l<h?a+l*f:n},unstuffLUT:function(e,t,r,s,o,a){var f,n=(1<<t)-1,i=0,l=0,u=0,c=0,h=0,y=[],w=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*w;var m=Math.ceil((a-s)/o);for(l=0;l<r;l++)c===0&&(f=e[i++],c=32),c>=t?(h=f>>>c-t&n,c-=t):(h=(f&n)<<(u=t-c)&n,h+=(f=e[i++])>>>(c=32-u)),y[l]=h<m?s+h*o:a;return y.unshift(s),y},unstuff2:function(e,t,r,s,o,a,f,n){var i,l,u,c,h=(1<<r)-1,y=0,w=0,m=0;if(o)for(i=0;i<s;i++)w===0&&(u=e[y++],w=32,m=0),w>=r?(l=u>>>m&h,w-=r,m+=r):(l=u>>>m&h,w=32-(c=r-w),l|=((u=e[y++])&(1<<c)-1)<<r-c,m=c),t[i]=o[l];else{var b=Math.ceil((n-a)/f);for(i=0;i<s;i++)w===0&&(u=e[y++],w=32,m=0),w>=r?(l=u>>>m&h,w-=r,m+=r):(l=u>>>m&h,w=32-(c=r-w),l|=((u=e[y++])&(1<<c)-1)<<r-c,m=c),t[i]=l<b?a+l*f:n}return t},unstuffLUT2:function(e,t,r,s,o,a){var f,n=(1<<t)-1,i=0,l=0,u=0,c=0,h=0,y=0,w=[],m=Math.ceil((a-s)/o);for(l=0;l<r;l++)c===0&&(f=e[i++],c=32,y=0),c>=t?(h=f>>>y&n,c-=t,y+=t):(h=f>>>y&n,c=32-(u=t-c),h|=((f=e[i++])&(1<<u)-1)<<t-u,y=u),w[l]=h<m?s+h*o:a;return w.unshift(s),w},originalUnstuff:function(e,t,r,s){var o,a,f,n,i=(1<<r)-1,l=0,u=0,c=4*e.length-Math.ceil(r*s/8);for(e[e.length-1]<<=8*c,o=0;o<s;o++)u===0&&(f=e[l++],u=32),u>=r?(a=f>>>u-r&i,u-=r):(a=(f&i)<<(n=r-u)&i,a+=(f=e[l++])>>>(u=32-n)),t[o]=a;return t},originalUnstuff2:function(e,t,r,s){var o,a,f,n,i=(1<<r)-1,l=0,u=0,c=0;for(o=0;o<s;o++)u===0&&(f=e[l++],u=32,c=0),u>=r?(a=f>>>c&i,u-=r,c+=r):(a=f>>>c&i,u=32-(n=r-u),a|=((f=e[l++])&(1<<n)-1)<<r-n,c=n),t[o]=a;return t}},J={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,r=65535,s=e.length,o=Math.floor(s/2),a=0;o;){var f=o>=359?359:o;o-=f;do t+=e[a++]<<8,r+=t+=e[a++];while(--f);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&s&&(r+=t+=e[a]<<8),((r=(65535&r)+(r>>>16))<<16|(t=(65535&t)+(t>>>16)))>>>0},readHeaderInfo:function(e,t){var r=t.ptr,s=new Uint8Array(e,r,6),o={};if(o.fileIdentifierString=String.fromCharCode.apply(null,s),o.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+o.fileIdentifierString;r+=6;var a,f=new DataView(e,r,8),n=f.getInt32(0,!0);if(o.fileVersion=n,r+=4,n>=3&&(o.checksum=f.getUint32(4,!0),r+=4),f=new DataView(e,r,12),o.height=f.getUint32(0,!0),o.width=f.getUint32(4,!0),r+=8,n>=4?(o.numDims=f.getUint32(8,!0),r+=4):o.numDims=1,f=new DataView(e,r,40),o.numValidPixel=f.getUint32(0,!0),o.microBlockSize=f.getInt32(4,!0),o.blobSize=f.getInt32(8,!0),o.imageType=f.getInt32(12,!0),o.maxZError=f.getFloat64(16,!0),o.zMin=f.getFloat64(24,!0),o.zMax=f.getFloat64(32,!0),r+=40,t.headerInfo=o,t.ptr=r,n>=3&&(a=n>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(e,r-a,o.blobSize-14))!==o.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,s=this.getDataTypeArray(r.imageType),o=r.numDims*this.getDataTypeSize(r.imageType),a=this.readSubArray(e,t.ptr,s,o),f=this.readSubArray(e,t.ptr+o,s,o);t.ptr+=2*o;var n,i=!0;for(n=0;n<r.numDims;n++)if(a[n]!==f[n]){i=!1;break}return r.minValues=a,r.maxValues=f,i},readSubArray:function(e,t,r,s){var o;if(r===Uint8Array)o=new Uint8Array(e,t,s);else{var a=new ArrayBuffer(s);new Uint8Array(a).set(new Uint8Array(e,t,s)),o=new r(a)}return o},readMask:function(e,t){var r,s,o=t.ptr,a=t.headerInfo,f=a.width*a.height,n=a.numValidPixel,i=new DataView(e,o,4),l={};if(l.numBytes=i.getUint32(0,!0),o+=4,(n===0||f===n)&&l.numBytes!==0)throw"invalid mask";if(n===0)r=new Uint8Array(Math.ceil(f/8)),l.bitset=r,s=new Uint8Array(f),t.pixels.resultMask=s,o+=l.numBytes;else if(l.numBytes>0){r=new Uint8Array(Math.ceil(f/8));var u=(i=new DataView(e,o,l.numBytes)).getInt16(0,!0),c=2,h=0,y=0;do{if(u>0)for(;u--;)r[h++]=i.getUint8(c++);else for(y=i.getUint8(c++),u=-u;u--;)r[h++]=y;u=i.getInt16(c,!0),c+=2}while(c<l.numBytes);if(u!==-32768||h<r.length)throw"Unexpected end of mask RLE encoding";s=new Uint8Array(f);var w=0,m=0;for(m=0;m<f;m++)7&m?(w=r[m>>3],w<<=7&m):w=r[m>>3],128&w&&(s[m]=1);t.pixels.resultMask=s,l.bitset=r,o+=l.numBytes}return t.ptr=o,t.mask=l,!0},readDataOneSweep:function(e,t,r,s){var o,a=t.ptr,f=t.headerInfo,n=f.numDims,i=f.width*f.height,l=f.imageType,u=f.numValidPixel*J.getDataTypeSize(l)*n,c=t.pixels.resultMask;if(r===Uint8Array)o=new Uint8Array(e,a,u);else{var h=new ArrayBuffer(u);new Uint8Array(h).set(new Uint8Array(e,a,u)),o=new r(h)}if(o.length===i*n)t.pixels.resultPixels=s?J.swapDimensionOrder(o,i,n,r,!0):o;else{t.pixels.resultPixels=new r(i*n);var y=0,w=0,m=0,b=0;if(n>1){if(s){for(w=0;w<i;w++)if(c[w])for(b=w,m=0;m<n;m++,b+=i)t.pixels.resultPixels[b]=o[y++]}else for(w=0;w<i;w++)if(c[w])for(b=w*n,m=0;m<n;m++)t.pixels.resultPixels[b+m]=o[y++]}else for(w=0;w<i;w++)c[w]&&(t.pixels.resultPixels[w]=o[y++])}return a+=u,t.ptr=a,!0},readHuffmanTree:function(e,t){var r=this.HUFFMAN_LUT_BITS_MAX,s=new DataView(e,t.ptr,16);if(t.ptr+=16,s.getInt32(0,!0)<2)throw"unsupported Huffman version";var o=s.getInt32(4,!0),a=s.getInt32(8,!0),f=s.getInt32(12,!0);if(a>=f)return!1;var n=new Uint32Array(f-a);J.decodeBits(e,t,n);var i,l,u,c,h=[];for(i=a;i<f;i++)h[l=i-(i<o?0:o)]={first:n[i-a],second:null};var y=e.byteLength-t.ptr,w=Math.ceil(y/4),m=new ArrayBuffer(4*w);new Uint8Array(m).set(new Uint8Array(e,t.ptr,y));var b,d=new Uint32Array(m),g=0,T=0;for(b=d[0],i=a;i<f;i++)(c=h[l=i-(i<o?0:o)].first)>0&&(h[l].second=b<<g>>>32-c,32-g>=c?(g+=c)===32&&(g=0,b=d[++T]):(g+=c-32,b=d[++T],h[l].second|=b>>>32-g));var S=0,p=0,v=new Be;for(i=0;i<h.length;i++)h[i]!==void 0&&(S=Math.max(S,h[i].first));p=S>=r?r:S;var C,k,I,P,x,L=[];for(i=a;i<f;i++)if((c=h[l=i-(i<o?0:o)].first)>0)if(C=[c,l],c<=p)for(k=h[l].second<<p-c,I=1<<p-c,u=0;u<I;u++)L[k|u]=C;else for(k=h[l].second,x=v,P=c-1;P>=0;P--)k>>>P&1?(x.right||(x.right=new Be),x=x.right):(x.left||(x.left=new Be),x=x.left),P!==0||x.val||(x.val=C[1]);return{decodeLut:L,numBitsLUTQick:p,numBitsLUT:S,tree:v,stuffedData:d,srcPtr:T,bitPos:g}},readHuffman:function(e,t,r,s){var o,a,f,n,i,l,u,c,h,y=t.headerInfo.numDims,w=t.headerInfo.height,m=t.headerInfo.width,b=m*w,d=this.readHuffmanTree(e,t),g=d.decodeLut,T=d.tree,S=d.stuffedData,p=d.srcPtr,v=d.bitPos,C=d.numBitsLUTQick,k=d.numBitsLUT,I=t.headerInfo.imageType===0?128:0,P=t.pixels.resultMask,x=0;v>0&&(p++,v=0);var L,A=S[p],D=t.encodeMode===1,M=new r(b*y),E=M;if(y<2||D){for(L=0;L<y;L++)if(y>1&&(E=new r(M.buffer,b*L,b),x=0),t.headerInfo.numValidPixel===m*w)for(c=0,l=0;l<w;l++)for(u=0;u<m;u++,c++){if(a=0,i=n=A<<v>>>32-C,32-v<C&&(i=n|=S[p+1]>>>64-v-C),g[i])a=g[i][1],v+=g[i][0];else for(i=n=A<<v>>>32-k,32-v<k&&(i=n|=S[p+1]>>>64-v-k),o=T,h=0;h<k;h++)if(!(o=n>>>k-h-1&1?o.right:o.left).left&&!o.right){a=o.val,v=v+h+1;break}v>=32&&(v-=32,A=S[++p]),f=a-I,D?(f+=u>0?x:l>0?E[c-m]:x,f&=255,E[c]=f,x=f):E[c]=f}else for(c=0,l=0;l<w;l++)for(u=0;u<m;u++,c++)if(P[c]){if(a=0,i=n=A<<v>>>32-C,32-v<C&&(i=n|=S[p+1]>>>64-v-C),g[i])a=g[i][1],v+=g[i][0];else for(i=n=A<<v>>>32-k,32-v<k&&(i=n|=S[p+1]>>>64-v-k),o=T,h=0;h<k;h++)if(!(o=n>>>k-h-1&1?o.right:o.left).left&&!o.right){a=o.val,v=v+h+1;break}v>=32&&(v-=32,A=S[++p]),f=a-I,D?(u>0&&P[c-1]?f+=x:l>0&&P[c-m]?f+=E[c-m]:f+=x,f&=255,E[c]=f,x=f):E[c]=f}}else for(c=0,l=0;l<w;l++)for(u=0;u<m;u++)if(c=l*m+u,!P||P[c])for(L=0;L<y;L++,c+=b){if(a=0,i=n=A<<v>>>32-C,32-v<C&&(i=n|=S[p+1]>>>64-v-C),g[i])a=g[i][1],v+=g[i][0];else for(i=n=A<<v>>>32-k,32-v<k&&(i=n|=S[p+1]>>>64-v-k),o=T,h=0;h<k;h++)if(!(o=n>>>k-h-1&1?o.right:o.left).left&&!o.right){a=o.val,v=v+h+1;break}v>=32&&(v-=32,A=S[++p]),f=a-I,E[c]=f}t.ptr=t.ptr+4*(p+1)+(v>0?4:0),t.pixels.resultPixels=M,y>1&&!s&&(t.pixels.resultPixels=J.swapDimensionOrder(M,b,y,r))},decodeBits:function(e,t,r,s,o){var a=t.headerInfo,f=a.fileVersion,n=0,i=e.byteLength-t.ptr>=5?5:e.byteLength-t.ptr,l=new DataView(e,t.ptr,i),u=l.getUint8(0);n++;var c=u>>6,h=c===0?4:3-c,y=(32&u)>0,w=31&u,m=0;if(h===1)m=l.getUint8(n),n++;else if(h===2)m=l.getUint16(n,!0),n+=2;else{if(h!==4)throw"Invalid valid pixel count type";m=l.getUint32(n,!0),n+=4}var b,d,g,T,S,p,v,C,k,I=2*a.maxZError,P=a.numDims>1?a.maxValues[o]:a.zMax;if(y){for(t.counter.lut++,C=l.getUint8(n),n++,T=Math.ceil((C-1)*w/8),S=Math.ceil(T/4),d=new ArrayBuffer(4*S),g=new Uint8Array(d),t.ptr+=n,g.set(new Uint8Array(e,t.ptr,T)),v=new Uint32Array(d),t.ptr+=T,k=0;C-1>>>k;)k++;T=Math.ceil(m*k/8),S=Math.ceil(T/4),d=new ArrayBuffer(4*S),(g=new Uint8Array(d)).set(new Uint8Array(e,t.ptr,T)),b=new Uint32Array(d),t.ptr+=T,p=f>=3?me.unstuffLUT2(v,w,C-1,s,I,P):me.unstuffLUT(v,w,C-1,s,I,P),f>=3?me.unstuff2(b,r,k,m,p):me.unstuff(b,r,k,m,p)}else t.counter.bitstuffer++,k=w,t.ptr+=n,k>0&&(T=Math.ceil(m*k/8),S=Math.ceil(T/4),d=new ArrayBuffer(4*S),(g=new Uint8Array(d)).set(new Uint8Array(e,t.ptr,T)),b=new Uint32Array(d),t.ptr+=T,f>=3?s==null?me.originalUnstuff2(b,r,k,m):me.unstuff2(b,r,k,m,!1,s,I,P):s==null?me.originalUnstuff(b,r,k,m):me.unstuff(b,r,k,m,!1,s,I,P))},readTiles:function(e,t,r,s){var o=t.headerInfo,a=o.width,f=o.height,n=a*f,i=o.microBlockSize,l=o.imageType,u=J.getDataTypeSize(l),c=Math.ceil(a/i),h=Math.ceil(f/i);t.pixels.numBlocksY=h,t.pixels.numBlocksX=c,t.pixels.ptr=0;var y,w,m,b,d,g,T,S,p,v,C=0,k=0,I=0,P=0,x=0,L=0,A=0,D=0,M=0,E=0,R=0,N=0,z=0,U=0,O=0,G=new r(i*i),_=f%i||i,V=a%i||i,H=o.numDims,X=t.pixels.resultMask,ee=t.pixels.resultPixels,Se=o.fileVersion>=5?14:15,ae=o.zMax;for(I=0;I<h;I++)for(x=I!==h-1?i:_,P=0;P<c;P++)for(E=I*a*i+P*i,R=a-(L=P!==c-1?i:V),S=0;S<H;S++){if(H>1?(v=ee,E=I*a*i+P*i,ee=new r(t.pixels.resultPixels.buffer,n*S*u,n),ae=o.maxValues[S]):v=null,A=e.byteLength-t.ptr,w={},O=0,D=(y=new DataView(e,t.ptr,Math.min(10,A))).getUint8(0),O++,p=o.fileVersion>=5?4&D:0,M=D>>6&255,(D>>2&Se)!=(P*i>>3&Se)||p&&S===0)throw"integrity issue";if((d=3&D)>3)throw t.ptr+=O,"Invalid block encoding ("+d+")";if(d!==2)if(d===0){if(p)throw"integrity issue";if(t.counter.uncompressed++,t.ptr+=O,N=(N=x*L*u)<(z=e.byteLength-t.ptr)?N:z,m=new ArrayBuffer(N%u==0?N:N+u-N%u),new Uint8Array(m).set(new Uint8Array(e,t.ptr,N)),b=new r(m),U=0,X)for(C=0;C<x;C++){for(k=0;k<L;k++)X[E]&&(ee[E]=b[U++]),E++;E+=R}else for(C=0;C<x;C++){for(k=0;k<L;k++)ee[E++]=b[U++];E+=R}t.ptr+=U*u}else if(g=J.getDataTypeUsed(p&&l<6?4:l,M),T=J.getOnePixel(w,O,g,y),O+=J.getDataTypeSize(g),d===3)if(t.ptr+=O,t.counter.constantoffset++,X)for(C=0;C<x;C++){for(k=0;k<L;k++)X[E]&&(ee[E]=p?Math.min(ae,v[E]+T):T),E++;E+=R}else for(C=0;C<x;C++){for(k=0;k<L;k++)ee[E]=p?Math.min(ae,v[E]+T):T,E++;E+=R}else if(t.ptr+=O,J.decodeBits(e,t,G,T,S),O=0,p)if(X)for(C=0;C<x;C++){for(k=0;k<L;k++)X[E]&&(ee[E]=G[O++]+v[E]),E++;E+=R}else for(C=0;C<x;C++){for(k=0;k<L;k++)ee[E]=G[O++]+v[E],E++;E+=R}else if(X)for(C=0;C<x;C++){for(k=0;k<L;k++)X[E]&&(ee[E]=G[O++]),E++;E+=R}else for(C=0;C<x;C++){for(k=0;k<L;k++)ee[E++]=G[O++];E+=R}else{if(p)if(X)for(C=0;C<x;C++)for(k=0;k<L;k++)X[E]&&(ee[E]=v[E]),E++;else for(C=0;C<x;C++)for(k=0;k<L;k++)ee[E]=v[E],E++;t.counter.constant++,t.ptr+=O}}H>1&&!s&&(t.pixels.resultPixels=J.swapDimensionOrder(t.pixels.resultPixels,n,H,r))},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:J.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e,t){var r=e.headerInfo.zMax,s=e.headerInfo.zMin,o=e.headerInfo.maxValues,a=e.headerInfo.numDims,f=e.headerInfo.height*e.headerInfo.width,n=0,i=0,l=0,u=e.pixels.resultMask,c=e.pixels.resultPixels;if(u)if(a>1){if(t)for(n=0;n<a;n++)for(l=n*f,r=o[n],i=0;i<f;i++)u[i]&&(c[l+i]=r);else for(i=0;i<f;i++)if(u[i])for(l=i*a,n=0;n<a;n++)c[l+a]=o[n]}else for(i=0;i<f;i++)u[i]&&(c[i]=r);else if(a>1&&s!==r)if(t)for(n=0;n<a;n++)for(l=n*f,r=o[n],i=0;i<f;i++)c[l+i]=r;else for(i=0;i<f;i++)for(l=i*a,n=0;n<a;n++)c[l+n]=o[n];else for(i=0;i<f*a;i++)c[i]=r},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:default:t=Float32Array;break;case 7:t=Float64Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:default:t="F32";break;case 7:t="F64"}return t},isValidPixelValue:function(e,t){if(t==null)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=5e-324&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=t===0?e:t===1?2:1;break;case 7:r=t===0?e:e-2*t+1;break;default:r=e}return r},getOnePixel:function(e,t,r,s){var o=0;switch(r){case 0:o=s.getInt8(t);break;case 1:o=s.getUint8(t);break;case 2:o=s.getInt16(t,!0);break;case 3:o=s.getUint16(t,!0);break;case 4:o=s.getInt32(t,!0);break;case 5:o=s.getUInt32(t,!0);break;case 6:o=s.getFloat32(t,!0);break;case 7:o=s.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return o},swapDimensionOrder:function(e,t,r,s,o){var a=0,f=0,n=0,i=0,l=e;if(r>1)if(l=new s(t*r),o)for(a=0;a<t;a++)for(i=a,n=0;n<r;n++,i+=t)l[i]=e[f++];else for(a=0;a<t;a++)for(i=a,n=0;n<r;n++,i+=t)l[f++]=e[i];return l}},Be=function(e,t,r){this.val=e,this.left=t,this.right=r},(vt={decode:function(e,t){var r=(t=t||{}).noDataValue,s=0,o={};o.ptr=t.inputOffset||0,o.pixels={},J.readHeaderInfo(e,o);var a=o.headerInfo,f=a.fileVersion,n=J.getDataTypeArray(a.imageType);if(f>5)throw"unsupported lerc version 2."+f;J.readMask(e,o),a.numValidPixel===a.width*a.height||o.pixels.resultMask||(o.pixels.resultMask=t.maskData);var i=a.width*a.height;o.pixels.resultPixels=new n(i*a.numDims),o.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var l,u=!t.returnPixelInterleavedDims;if(a.numValidPixel!==0)if(a.zMax===a.zMin)J.constructConstantSurface(o,u);else if(f>=4&&J.checkMinMaxRanges(e,o))J.constructConstantSurface(o,u);else{var c=new DataView(e,o.ptr,2),h=c.getUint8(0);if(o.ptr++,h)J.readDataOneSweep(e,o,n,u);else if(f>1&&a.imageType<=1&&Math.abs(a.maxZError-.5)<1e-5){var y=c.getUint8(1);if(o.ptr++,o.encodeMode=y,y>2||f<4&&y>1)throw"Invalid Huffman flag "+y;y?J.readHuffman(e,o,n,u):J.readTiles(e,o,n,u)}else J.readTiles(e,o,n,u)}o.eofOffset=o.ptr,t.inputOffset?(l=o.headerInfo.blobSize+t.inputOffset-o.ptr,Math.abs(l)>=1&&(o.eofOffset=t.inputOffset+o.headerInfo.blobSize)):(l=o.headerInfo.blobSize-o.ptr,Math.abs(l)>=1&&(o.eofOffset=o.headerInfo.blobSize));var w={width:a.width,height:a.height,pixelData:o.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,validPixelCount:a.numValidPixel,dimCount:a.numDims,dimStats:{minValues:a.minValues,maxValues:a.maxValues},maskData:o.pixels.resultMask};if(o.pixels.resultMask&&J.isValidPixelValue(a.imageType,r)){var m=o.pixels.resultMask;for(s=0;s<i;s++)m[s]||(w.pixelData[s]=r);w.noDataValue=r}return o.noDataValue=r,t.returnFileInfo&&(w.fileInfo=J.formatFileInfo(o)),w},getBandCount:function(e){for(var t=0,r=0,s={ptr:0,pixels:{}};r<e.byteLength-58;)J.readHeaderInfo(e,s),r+=s.headerInfo.blobSize,t++,s.ptr=r;return t}})!==void 0&&(Ct.exports=vt);const Tt=bt.exports,St=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Ae=4294967296,ar=new Set([1,5,6,7,8,34712,34887]);function kt(e,t){let r="unknown";return e===3?r="f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function Ge(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;default:t=Float32Array}return t}function sr(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function It(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function be(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Je(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function Y(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function qe(e,t,r,s=0,o=xe.TIFF_TAGS,a=4){const f=a===8,n=f?et(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),i=4+2*a,l=f?8:2,u=l+n*i;if(r+u>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:u};const c=r+u+4<=e.byteLength?_e(new DataView(e,r+u,a===8?8:4),0,t,a===8):null,h=r+l,y=new Map;let w,m,b,d,g,T,S;for(let p=0;p<n;p++){m=new DataView(e,h+i*p,i),b=m.getUint16(0,t),g=m.getUint16(2,t),d=xe.getTagName(b,o);const v=[];a===2?(T=m.getUint16(4,t),S=m.getUint16(6,t)):a===4?(T=m.getUint32(4,t),S=m.getUint32(8,t)):a===8&&(T=_e(m,4,t,!0),S=_e(m,12,t,!0),v.push(m.getUint32(12,t)),v.push(m.getUint32(16,t))),w={id:b,type:g,valueCount:T,valueOffset:S,valueOffsets:v,values:null},dr(e,t,w,s,!1,a),y.set(d,w)}return{success:!0,ifd:y,nextIFD:c,requiredBufferSize:u}}const lr=function(e,t){return Tt.decode(e,{inputOffset:t,returnFileInfo:!0}).pixelData},Xe=function(e,t,r,s,o){var a,f;const n=Oe===t,i=Y(r,"BITSPERSAMPLE"),l=kt((a=Y(r,"SAMPLEFORMAT"))!=null?a:1,i),u=(f=Y(r,"COMPRESSION"))!=null?f:1,c=Ge(l);let h,y,w,m,b,d,g;if(u===34887)return lr(e,s);if(u===1)w=e.slice(s,s+o),m=new Uint8Array(w);else if(u===8||u===32946)m=new Uint8Array(e,s,o),d=new ve(m),g=d.getBytes(),w=new ArrayBuffer(g.length),m=new Uint8Array(w),m.set(g);else if(u===6){m=new Uint8Array(e,s,o);const T=new Me;T.parse(m);const S=T.getData(T.width,T.height,!0);w=new ArrayBuffer(S.length),m=new Uint8Array(w),m.set(S)}else if(u===7){const T=r.get("JPEGTABLES").values,S=T.length-2;m=new Uint8Array(S+o-2);for(let k=0;k<S;k++)m[k]=T[k];const p=new Uint8Array(e,s+2,o-2);for(let k=0;k<p.length;k++)m[S+k]=p[k];const v=new Me;v.parse(m);const C=v.getData(v.width,v.height,!0);w=new ArrayBuffer(C.length),m=new Uint8Array(w),m.set(C)}else u===5&&(m=Ke(e,s,o,t),w=m.buffer);if(l==="u8"||l==="s8"||n)y=new c(w);else{switch(w=new ArrayBuffer(m.length),b=new Uint8Array(w),l){case"u16":case"s16":for(h=0;h<m.length;h+=2)b[h]=m[h+1],b[h+1]=m[h];break;case"u32":case"s32":case"f32":for(h=0;h<m.length;h+=4)b[h]=m[h+3],b[h+1]=m[h+2],b[h+2]=m[h+1],b[h+3]=m[h]}y=new c(w)}return y},fr=function(e,t,r){var s;const o=be(r,"TILEOFFSETS");if(o===void 0)return null;const a=be(r,"TILEBYTECOUNTS"),{width:f,height:n,pixelType:i,tileWidth:l,tileHeight:u}=Ze([r]),c=Qe(r,t),h=t.planes,y=f*n,w=Y(r,"BITSPERSAMPLE"),m=((s=Y(r,"COMPRESSION"))!=null?s:1)===34887,b=Ge(i),d=[];for(let E=0;E<h;E++)d.push(new b(y));let g,T,S,p,v,C,k,I,P,x,L,A,D;const M=Math.ceil(f/l);if(w%8==0)if(m&&c&&h>1){const E=Math.round(o.length/h);for(g=0;g<E;g++){C=Math.floor(g/M)*u,k=g%M*l,I=C*f+k;for(let R=0;R<h;R++){const N=g*h+R;for(S=Xe(e,t.littleEndian,r,o[N],a[N]),x=0,P=I,A=Math.min(l,f-k),L=Math.min(u,n-C),D=d[R],p=0;p<L;p++)for(P=I+p*f,x=p*l,v=0;v<A;v++,P++,x++)D[P]=S[x]}}}else for(g=0;g<o.length;g++)for(C=Math.floor(g/M)*u,k=g%M*l,I=C*f+k,S=Xe(e,t.littleEndian,r,o[g],a[g]),x=0,P=I,A=Math.min(l,f-k),L=Math.min(u,n-C),T=0;T<h;T++)if(D=d[T],c||m)for(p=0;p<L;p++)for(P=I+p*f,x=l*u*T+p*l,v=0;v<A;v++,P++,x++)D[P]=S[x];else for(p=0;p<L;p++)for(P=I+p*f,x=p*l*h+T,v=0;v<A;v++,P++,x+=h)D[P]=S[x];return{width:f,height:n,pixelType:i,pixels:d}},ur=function(e,t,r){var s;const o=Oe===t.littleEndian,a=be(r,"STRIPOFFSETS");if(a===void 0)return null;const{width:f,height:n,pixelType:i}=Ze([r]),l=t.planes,u=f*n,c=Y(r,"BITSPERSAMPLE"),h=Ge(i),y=new h(u*l),w=be(r,"STRIPBYTECOUNTS"),m=Y(r,"ROWSPERSTRIP"),b=(s=Y(r,"COMPRESSION"))!=null?s:1;let d,g,T,S,p,v,C,k,I,P,x,L=m;if(c%8==0)for(d=0;d<a.length;d++){if(p=d*(m*f)*l,L=(d+1)*m>n?n-d*m:m,i==="u8"||i==="s8"||o){if(b===8||b===32946)C=new Uint8Array(e,a[d],w[d]),P=new ve(C),x=P.getBytes(),v=new ArrayBuffer(x.length),C=new Uint8Array(v),C.set(x),C.length!==L*f*l*c/8&&console.log("strip byte counts is different than expected");else if(b===6){C=new Uint8Array(e,a[d],w[d]);const D=new Me;D.parse(C);const M=D.getData(D.width,D.height,!0);v=new ArrayBuffer(M.length),C=new Uint8Array(v),C.set(M)}else b===5?(C=Ke(e,a[d],w[d],t.littleEndian),v=C.buffer):b===1&&(w[d]!==L*f*l*c/8&&console.log("strip byte counts is different than expected"),v=e.slice(a[d],a[d]+w[d]));S=new h(v)}else{switch(b===6||b===8||b===32946?(C=new Uint8Array(e,a[d],w[d]),P=new ve(C),C=P.getBytes(),v=new ArrayBuffer(C.length),k=new Uint8Array(v),C.length!==L*f*l*c/8&&console.log("strip byte counts is different than expected")):b===1&&(w[d]!==L*f*l*c/8&&console.log("strip byte counts is different than expected"),v=new ArrayBuffer(w[d]),C=new Uint8Array(e,a[d],w[d]),k=new Uint8Array(v)),i){case"u16":case"s16":for(T=0;T<C.length;T+=2)k[T]=C[T+1],k[T+1]=C[T];break;case"u32":case"s32":case"f32":for(T=0;T<C.length;T+=4)k[T]=C[T+3],k[T+1]=C[T+2],k[T+2]=C[T+1],k[T+3]=C[T]}S=new h(v)}y.set(S,p)}const A=[];if(l===1)A.push(y);else for(d=0;d<l;d++){for(I=new h(u),g=0;g<u;g++)I[g]=y[g*l+d];A.push(I)}return{width:f,height:n,pixelType:i,pixels:A}},cr=function(e,t,r){if(!(e&&e.length>0&&t&&r))return null;let s,o,a;const f=e[0].length,n=e.length,i=new Uint8Array(f);for(let l=0;l<n;l++)if(s=e[l],o=t[l],a=r[l],l===0)for(let u=0;u<f;u++)i[u]=s[u]<o||s[u]>a?0:1;else for(let u=0;u<f;u++)i[u]&&(i[u]=s[u]<o||s[u]>a?0:1);return i},hr=function(e){if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let s,o,a,f,n;for(let d=0;d<t.length;d++)s=t[d],o=s.slice("<Item ".length,s.indexOf(">")),f=s.indexOf("sample="),f>-1&&(n=s.slice(f+'sample="'.length,s.indexOf('"',f+'sample="'.length))),f=s.indexOf("name="),f>-1&&(o=s.slice(f+'name="'.length,s.indexOf('"',f+'name="'.length))),o&&(a=s.slice(s.indexOf(">")+1,s.indexOf("</Item>")).trim(),n!=null?r.has(o)?r.get(o)[n]=a:r.set(o,[a]):r.set(o,a)),n=null;const i=r.get("STATISTICS_MINIMUM"),l=r.get("STATISTICS_MAXIMUM"),u=r.get("STATISTICS_MEAN"),c=r.get("STATISTICS_STDDEV");let h=null;if(i&&l){h=[];for(let d=0;d<i.length;d++)h.push({min:parseFloat(i[d]),max:parseFloat(l[d]),avg:u&&parseFloat(u[d]),stddev:c&&parseFloat(c[d])})}const y=r.get("BandName"),w=r.get("WavelengthMin"),m=r.get("WavelengthMax");let b=null;if(y){b=[];for(let d=0;d<y.length;d++)b.push({BandName:y[d],WavelengthMin:w&&parseFloat(w[d]),WavelengthMax:m&&parseFloat(m[d])})}return{statistics:h,bandProperties:b,dataType:r.get("DataType"),rawMetadata:r}};function dr(e,t,r,s=0,o=!1,a=4){if(r.values)return!0;const f=r.type,n=r.valueCount;let i=r.valueOffset,l=[];const u=St[f],c=8*u,h=n*u,y=n*St[f]*8;let w,m;const b=a===8?64:32,d=r.valueOffsets;if(y>b&&h>(o?e.byteLength:e?e.byteLength-i+s:0))return r.offlineOffsetSize=[i,h],r.values=null,!1;if(y<=b){if(!t)if(b<=32)i>>>=32-y;else{const g=d!=null&&d.length?d[0]:i>>>0,T=d!=null&&d.length?d[1]:Math.round((i-g)/Ae);y<=32?(i=g>>>32-y,d[0]=i):(i=g*2**(32-y)+(T>>>32-y),d[0]=g,d[1]=T>>>32-y)}if(n===1&&c===b)l=[i];else if(b===64){const g=d!=null&&d.length?d[0]:i>>>0,T=d!=null&&d.length?d[1]:Math.round((i-g)/Ae);let S=g,p=32;for(m=1;m<=n;m++){const v=32-c*m%32;if(p<c){const C=S<<v>>>32-p,k=T<<32-p>>>32-p;S=T,l.push(C+k*2**(c-p)),p-=32-(c-p)}else l.push(S<<v>>>32-c),p-=c;p===0&&(p=32,S=T)}}else for(m=1;m<=n;m++){const g=32-c*m;l.push(i<<g>>>32-c)}}else{i-=s,o&&(i=0);for(let g=i;g<i+h;g+=u){switch(f){case 1:case 2:case 7:w=new DataView(e,g,1).getUint8(0);break;case 3:w=new DataView(e,g,2).getUint16(0,t);break;case 4:case 13:w=new DataView(e,g,4).getUint32(0,t);break;case 5:w=new DataView(e,g,4).getUint32(0,t)/new DataView(e,g+4,4).getUint32(0,t);break;case 6:w=new DataView(e,g,1).getInt8(0);break;case 8:w=new DataView(e,g,2).getInt16(0,t);break;case 9:w=new DataView(e,g,4).getInt32(0,t);break;case 10:w=new DataView(e,g,4).getInt32(0,t)/new DataView(e,g+4,4).getInt32(0,t);break;case 11:w=new DataView(e,g,4).getFloat32(0,t);break;case 12:w=new DataView(e,g,8).getFloat64(0,t);break;case 16:case 18:w=et(new DataView(e,g,8),0,t);break;case 17:w=mr(new DataView(e,g,8),0,t);break;default:w=null}l.push(w)}}if(f===2){let g="";const T=l;for(l=[],m=0;m<T.length;m++)T[m]===0&&g!==""?(l.push(g),g=""):g+=String.fromCharCode(T[m]);g===""&&l.length!==0||l.push(g)}return r.values=l,!0}function Ze(e){var t,r;const s=e[0],o=Y(s,"TILEWIDTH"),a=Y(s,"TILELENGTH"),f=Y(s,"IMAGEWIDTH"),n=Y(s,"IMAGELENGTH"),i=Y(s,"BITSPERSAMPLE"),l=Y(s,"SAMPLESPERPIXEL"),u=(t=Y(s,"SAMPLEFORMAT"))!=null?t:1,c=kt(u,i),h=Qe(s),y=It(s,"GDAL_NODATA");let w;y!=null&&y.length&&(w=y.map(U=>parseFloat(U)),w.some(U=>isNaN(U))&&(w=null));const m=(r=Y(s,"COMPRESSION"))!=null?r:1;let b;switch(m){case 1:b="NONE";break;case 2:case 3:case 4:case 32771:b="CCITT";break;case 5:b="LZW";break;case 6:case 7:b="JPEG";break;case 32773:b="PACKBITS";break;case 8:case 32946:b="DEFLATE";break;case 34712:b="JPEG2000";break;case 34887:b="LERC";break;default:b=String(m)}let d=!0,g="";ar.has(m)||(d=!1,g+="unsupported tag compression "+m),u>3&&(d=!1,g+="unsupported tag sampleFormat "+u),i%8!=0&&(d=!1,g+="unsupported tag bitsPerSample "+i);const T=Je(s,"GEOASCIIPARAMS");let S;if(T){const U=T.split("|").filter(G=>G.indexOf("ESRI PE String = ")>-1)[0],O=U?U.replace("ESRI PE String = ",""):"";S=O.startsWith("COMPD_CS")||O.startsWith("PROJCS")||O.startsWith("GEOGCS")?{wkid:null,wkt:O}:null}const p=be(s,"GEOTIEPOINTS"),v=be(s,"GEOPIXELSCALE"),C=be(s,"GEOTRANSMATRIX"),k=s.has("GEOKEYDIRECTORY")?s.get("GEOKEYDIRECTORY").data:null;let I,P,x=!1;if(k){x=Y(k,"GTRasterTypeGeoKey")===2;const U=Y(k,"GTModelTypeGeoKey");if(U===2){const O=Y(k,"GeographicTypeGeoKey");O>=1024&&O<=32766&&(S={wkid:O})}else if(U===1){const O=Y(k,"ProjectedCSTypeGeoKey");O>=1024&&O<=32766&&(S={wkid:O})}}if(v&&p&&p.length>=6?(I=[v[0],0,p[3]-p[0]*v[0],0,-Math.abs(v[1]),p[4]-p[1]*v[1]],x&&(I[2]-=.5*I[0]+.5*I[1],I[5]-=.5*I[3]+.5*I[4])):C&&C.length===16&&(I=x?[C[0],C[1],C[3]-.5*C[0],C[4],C[5],C[7]-.5*C[5]]:[C[0],C[1],C[3],C[4],C[5],C[7]]),I){const U=[{x:0,y:n},{x:0,y:0},{x:f,y:n},{x:f,y:0}];let O,G=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,H=Number.NEGATIVE_INFINITY;for(let X=0;X<U.length;X++)O=sr(U[X],I),G=O.x>G?G:O.x,V=O.x<V?V:O.x,_=O.y>_?_:O.y,H=O.y<H?H:O.y;P={xmin:G,xmax:V,ymin:_,ymax:H,spatialReference:S}}else P={xmin:-.5,ymin:.5-n,xmax:f-.5,ymax:.5,spatialReference:S};const L=e.filter(U=>Je(U,"NEWSUBFILETYPE")===1);let A,D,M,E,R;if(L.length>0){A=Math.round(Math.log(f/Y(L[0],"IMAGEWIDTH"))/Math.LN2);const U=L[L.length-1];D=Math.round(Math.log(f/Y(U,"IMAGEWIDTH"))/Math.LN2),M=Y(U,"TILEWIDTH"),E=Y(U,"TILELENGTH")}M=D>0?M||o:null,E=D>0?E||a:null,o&&(R=[{maxCol:Math.ceil(f/o)-1,maxRow:Math.ceil(n/a)-1,minRow:0,minCol:0}],L.forEach(U=>{R.push({maxCol:Math.ceil(Y(U,"IMAGEWIDTH")/Y(U,"TILEWIDTH"))-1,maxRow:Math.ceil(Y(U,"IMAGELENGTH")/Y(U,"TILELENGTH"))-1,minRow:0,minCol:0})}));const N=Je(e[0],"GDAL_METADATA"),z=hr(N);return g+=" "+xt({width:f,height:n,tileWidth:o,tileHeight:a,planes:l,ifds:e}),{width:f,height:n,tileWidth:o,tileHeight:a,planes:l,isBSQ:h,pixelType:c,compression:b,noData:w,isSupported:d,message:g,extent:P,affine:v?null:I,firstPyramidLevel:A,maximumPyramidLevel:D,pyramidBlockWidth:M,pyramidBlockHeight:E,tileBoundary:R,metadata:z}}function Qe(e,t){const r=It(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function pr(e){const{littleEndian:t,isBigTiff:r,firstIFD:s}=gr(e);let o=s;const a=[];do{const f=yr(e,t,o,0,xe.TIFF_TAGS,r?8:4);if(!f.success)break;a.push(f.ifd),o=f.nextIFD}while(o>0);return pe(ne({},Ze(a)),{littleEndian:t,isBigTiff:r,ifds:a})}function et(e,t,r){const s=e.getUint32(t,r),o=e.getUint32(t+4,r);return r?o*Ae+s:s*Ae+o}function mr(e,t,r){let s=r?e.getInt32(t,r):e.getUint32(t,r),o=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const a=(r?s:o)>=0?1:-1;return r?s*=a:o*=a,a*(r?o*Ae+s:s*Ae+o)}function _e(e,t,r,s){return s?et(e,t,r):e.getUint32(t,r)}function gr(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let s=null;if(r===18761)s=!0;else{if(r!==19789)throw"unexpected endianess byte";s=!1}const o=t.getUint16(2,s);if(o!==42&&o!==43)throw"unexpected tiff identifier";let a=4;const f=o===43;if(f){const n=t.getUint16(a,s);if(a+=2,n!==8||t.getUint16(a,s)!==0)throw"unsupported bigtiff version";a+=2}return{littleEndian:s,isBigTiff:f,firstIFD:_e(t,a,s,f)}}function yr(e,t,r,s=0,o=xe.TIFF_TAGS,a=4){const f=qe(e,t,r,s,o,a);let n;const i=f.ifd;if(i){if(xe.ifdTags.forEach((l,u)=>{i.has(u)&&(n=i.get(u),n.data=qe(e,t,n.valueOffset-s,s,l).ifd)}),i.has("GEOKEYDIRECTORY")){n=i.get("GEOKEYDIRECTORY");const l=n.values;if(l&&l.length>4){const u=l[0]+"."+l[1]+"."+l[2];n.data=qe(e,t,n.valueOffset+6-s,s,xe.GEO_KEYS,2).ifd,n.data&&n.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[u]})}}if(i.has("XMP")){n=i.get("XMP");const l=n.values;typeof l[0]=="number"&&n.type===7&&(n.values=[er(new Uint8Array(l))])}}return f}function xt(e){const{width:t,height:r,tileHeight:s,tileWidth:o}=e,a=e.planes,f=o?o*s:t*r,n=Y(e.ifds[0],"BITSPERSAMPLE");let i="";return f*a>2**30/(n>8?n/8:1)&&(i=o?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),i}function wr(e,t){var r;const{headerInfo:s,ifd:o,offsets:a,sizes:f}=t,n=a.map((P,x)=>Xe(e,s.littleEndian,o,P,f[x]||e.byteLength)),i=Qe(o,s),{pixelType:l,planes:u}=s,c=Ge(l),h=Y(o,"TILEWIDTH"),y=Y(o,"TILELENGTH"),w=(r=Y(o,"COMPRESSION"))!=null?r:1,m=h*y;let b;const d=[];let g=n[0];const T=w===34887;for(let P=0;P<u;P++){if(b=new c(m),i&&T){g=n[P];for(let x=0;x<m;x++)b[x]=g[P][x+P]}else if(i||T&&!i)b=g.slice(m*P,m*(P+1));else for(let x=0;x<m;x++)b[x]=g[x*u+P];d.push(b)}const S=s.noData?s.noData[0]:null,p=s.metadata?s.metadata.statistics:null,v=p?p.map(P=>P.min):null,C=p?p.map(P=>P.max):null;let k,I;if(S!=null)if(k=new Uint8Array(m),Math.abs(S)>1e24)for(I=0;I<m;I++)Math.abs((d[0][I]-S)/S)<1e-6?k[I]=0:k[I]=1;else for(I=0;I<m;I++)d[0][I]===S?k[I]=0:k[I]=1;else v&&C&&t.applyMinMaxConstraint&&(k=cr(d,v,C));return{pixelType:l,width:h,height:y,pixels:d,mask:k,noDataValue:S}}function Cr(e,t=0,r){r=r||pr(e);const{ifds:s,noData:o}=r;if(s.length===0)throw"no valid image file directory";const a=xt(r);if(a)throw a;let f,n;const i=t===-1?s[s.length-1]:s[t],l=o?o[0]:null;if(n=r.tileWidth?fr(e,r,i):ur(e,r,i),l!==null){if(n.mask=new Uint8Array(n.width*n.height),Math.abs(l)>1e24)for(f=0;f<n.width*n.height;f++)Math.abs((n.pixels[0][f]-l)/l)<1e-6?n.mask[f]=0:n.mask[f]=1;else for(f=0;f<n.width*n.height;f++)n.pixels[0][f]===l?n.mask[f]=0:n.mask[f]=1;n.noDataValue=l}return n}const At=function(e,t){const r=t.width*t.height,s=t.pixelType;return Math.floor(e.byteLength/(r*Dt(s)))},Dt=function(e){let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},vr=function(e,t){if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),s=new Uint8Array(t);let o=0,a=0,f=0,n=0;for(f=0;f<r.length-1;f++)for(a=r[f],n=7;n>=0;n--)s[o++]=a>>n&1;for(n=7;o<t-1;)a=r[r.length-1],s[o++]=a>>n&1,n--;return s};class br{static decode(t,r){const s=r.pixelType,o=[],a=r.width*r.height,f=At(t,r),{bandIds:n,format:i}=r,l=n&&n.length||At(t,r),u=t.byteLength-t.byteLength%(a*Dt(s)),c=new s(t,0,a*f);let h,y,w,m,b;if(i==="bip")for(h=0;h<l;h++){for(m=new s(a),b=n?n[h]:h,y=0;y<a;y++)m[y]=c[y*f+b];o.push(m)}else if(i==="bsq")for(h=0;h<l;h++)b=n?n[h]:h,o.push(c.subarray(b*a,(b+1)*a));return u<t.byteLength-1&&(w=vr(t.slice(u),a)),{pixels:o,mask:w}}}var Tr=function(e){var t,r,s,o,a,f;function n(i){var l,u,c,h,y,w,m,b,d,g,T,S,p;for(this.data=i,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},y=null;;){switch(l=this.readUInt32(),b=function(){var v,C;for(C=[],v=0;v<4;++v)C.push(String.fromCharCode(this.data[this.pos++]));return C}.call(this).join(""),b){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":y&&this.animation.frames.push(y),this.pos+=4,y={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},h=this.readUInt16(),c=this.readUInt16()||100,y.delay=1e3*h/c,y.disposeOp=this.data[this.pos++],y.blendOp=this.data[this.pos++],y.data=[];break;case"IDAT":case"fdAT":for(b==="fdAT"&&(this.pos+=4,l-=4),i=(y!=null?y.data:void 0)||this.imgData,T=0;0<=l?T<l:T>l;0<=l?++T:--T)i.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(l),(d=255-this.transparency.indexed.length)>0)for(S=0;0<=d?S<d:S>d;0<=d?++S:--S)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":w=(g=this.read(l)).indexOf(0),m=String.fromCharCode.apply(String,g.slice(0,w)),this.text[m]=String.fromCharCode.apply(String,g.slice(w+1));break;case"IEND":return y&&this.animation.frames.push(y),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(p=this.colorType)===4||p===6,u=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*u,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return n.load=function(i,l,u){var c;return typeof l=="function"&&(u=l),(c=new XMLHttpRequest).open("GET",i,!0),c.responseType="arraybuffer",c.onload=function(){var h;return h=new n(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof(l!=null?l.getContext:void 0)=="function"&&h.render(l),typeof u=="function"?u(h):void 0},c.send(null)},r=1,s=2,t=0,n.prototype.read=function(i){var l,u;for(u=[],l=0;0<=i?l<i:l>i;0<=i?++l:--l)u.push(this.data[this.pos++]);return u},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(i){var l,u,c,h,y,w,m,b,d,g,T,S,p,v,C,k,I,P,x,L,A,D,M;if(i==null&&(i=this.imgData),i.length===0)return new Uint8Array(0);for(i=(i=new ve(i)).getBytes(),k=(S=this.pixelBitlength/8)*this.width,p=new Uint8Array(k*this.height),w=i.length,C=0,v=0,u=0;v<w;){switch(i[v++]){case 0:for(h=x=0;x<k;h=x+=1)p[u++]=i[v++];break;case 1:for(h=L=0;L<k;h=L+=1)l=i[v++],y=h<S?0:p[u-S],p[u++]=(l+y)%256;break;case 2:for(h=A=0;A<k;h=A+=1)l=i[v++],c=(h-h%S)/S,I=C&&p[(C-1)*k+c*S+h%S],p[u++]=(I+l)%256;break;case 3:for(h=D=0;D<k;h=D+=1)l=i[v++],c=(h-h%S)/S,y=h<S?0:p[u-S],I=C&&p[(C-1)*k+c*S+h%S],p[u++]=(l+Math.floor((y+I)/2))%256;break;case 4:for(h=M=0;M<k;h=M+=1)l=i[v++],c=(h-h%S)/S,y=h<S?0:p[u-S],C===0?I=P=0:(I=p[(C-1)*k+c*S+h%S],P=c&&p[(C-1)*k+(c-1)*S+h%S]),m=y+I-P,b=Math.abs(m-y),g=Math.abs(m-I),T=Math.abs(m-P),d=b<=g&&b<=T?y:g<=T?I:P,p[u++]=(l+d)%256;break;default:throw new Error("Invalid filter algorithm: "+i[v-1])}C++}return p},n.prototype.decodePalette=function(){var i,l,u,c,h,y,w,m,b;for(u=this.palette,y=this.transparency.indexed||[],h=new Uint8Array((y.length||0)+u.length),c=0,i=0,l=w=0,m=u.length;w<m;l=w+=3)h[c++]=u[l],h[c++]=u[l+1],h[c++]=u[l+2],h[c++]=(b=y[i++])!=null?b:255;return h},n.prototype.copyToImageData=function(i,l){var u,c,h,y,w,m,b,d,g,T,S;if(c=this.colors,g=null,u=this.hasAlphaChannel,this.palette.length&&(g=(S=this._decodedPalette)!=null?S:this._decodedPalette=this.decodePalette(),c=4,u=!0),d=(h=i.data||i).length,w=g||l,y=m=0,c===1)for(;y<d;)b=g?4*l[y/4]:m,T=w[b++],h[y++]=T,h[y++]=T,h[y++]=T,h[y++]=u?w[b++]:this.transparency.grayscale&&this.transparency.grayscale===T?0:255,m=b;else for(;y<d;)b=g?4*l[y/4]:m,h[y++]=w[b++],h[y++]=w[b++],h[y++]=w[b++],h[y++]=u?w[b++]:this.transparency.rgb&&this.transparency.rgb[1]===w[b-3]&&this.transparency.rgb[3]===w[b-2]&&this.transparency.rgb[5]===w[b-1]?0:255,m=b},n.prototype.decode=function(){var i;return i=new Uint8Array(this.width*this.height*4),this.copyToImageData(i,this.decodePixels()),i},a=e.document&&e.document.createElement("canvas"),f=a&&a.getContext("2d"),o=function(i){var l;return f.width=i.width,f.height=i.height,f.clearRect(0,0,i.width,i.height),f.putImageData(i,0,0),(l=new Image).src=a.toDataURL(),l},n.prototype.decodeFrames=function(i){var l,u,c,h,y,w,m,b;if(this.animation){for(b=[],u=y=0,w=(m=this.animation.frames).length;y<w;u=++y)l=m[u],c=i.createImageData(l.width,l.height),h=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(c,h),l.imageData=c,b.push(l.image=o(c));return b}},n.prototype.renderFrame=function(i,l){var u,c,h;return u=(c=this.animation.frames)[l],h=c[l-1],l===0&&i.clearRect(0,0,this.width,this.height),(h!=null?h.disposeOp:void 0)===r?i.clearRect(h.xOffset,h.yOffset,h.width,h.height):(h!=null?h.disposeOp:void 0)===s&&i.putImageData(h.imageData,h.xOffset,h.yOffset),u.blendOp===t&&i.clearRect(u.xOffset,u.yOffset,u.width,u.height),i.drawImage(u.image,u.xOffset,u.yOffset)},n.prototype.animate=function(i){var l,u,c,h,y,w,m=this;return u=0,w=this.animation,h=w.numFrames,c=w.frames,y=w.numPlays,(l=function(){var b,d;if(b=u++%h,d=c[b],m.renderFrame(i,b),h>1&&u/h<y)return m.animation._timeout=setTimeout(l,d.delay)})()},n.prototype.stopAnimation=function(){var i;return clearTimeout((i=this.animation)!=null?i._timeout:void 0)},n.prototype.render=function(i){var l,u;return i._png&&i._png.stopAnimation(),i._png=this,i.width=this.width,i.height=this.height,l=i.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(u=l.createImageData(this.width,this.height),this.copyToImageData(u,this.decodePixels()),l.putImageData(u,0,0))},n}(self);const Sr=new Set(["jpg","png","bmp","gif"]);function kr(e,t){if(!Oe)throw new ce("rasterCoded:decode","lerc decoder is not supported on big endian platform");const{width:r,height:s,pixelType:o}=t,a=Et(o),f=a.pixelTypeCtor,n=t.noDataValue==null?a.noDataValue:t.noDataValue;let i,l,u=0,c=0;const h=e.byteLength-10;for(;c<h;){const y=qt(e,{inputOffset:c,encodedMaskData:i,returnMask:u===0,returnEncodedMask:u===0,returnFileInfo:!0,pixelType:f,noDataValue:n});if(r&&s&&(y.width!==r||y.height!==s))throw new ce("rasterCoded:decode","lerc decoded result has width or height different from specified in options");if(c=y.fileInfo.eofOffset,u===0&&(i=y.encodedMaskData,l=new le({width:y.width,height:y.height,pixels:[],pixelType:o,mask:y.maskData,statistics:[]})),u++,l.addData({pixels:y.pixelData,statistics:{minValue:y.minValue,maxValue:y.maxValue,noDataValue:y.noDataValue}}),h-c>10){const w=String.fromCharCode.apply(null,new Uint8Array(e,c,10));c+=w.indexOf("CntZ")>-1?w.indexOf("CntZ"):0}}return l}function Ir(e,t){if(!Oe)throw new ce("rasterCoded:decode","lerc decoder is not supported on big endian platform");let r,s,o,a=0,f=t.offset||0,n=0;const i=t.eof||e.byteLength-10,l=[],{width:u,height:c}=t;let h=0;for(;f<i;){var y;if(s=Tt.decode(e,{inputOffset:f,maskData:r,returnFileInfo:!0}),u&&c&&(s.width!==u||s.height!==c))throw new ce("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");if(f=s.fileInfo.eofOffset,r=s.maskData,a===0&&(n=s.fileInfo.numValidPixel,o=new le({width:s.width,height:s.height,pixels:[],pixelType:s.fileInfo.pixelType,mask:r,statistics:[]})),s.fileInfo.mask&&s.fileInfo.mask.numBytes>0&&h++,r&&l.push(r),s.dimCount>1&&((y=s.pixelData)==null?void 0:y.length)===s.width*s.height*s.dimCount){var w,m,b,d;s.pixelData=s.pixelData.slice(-s.width*s.height);const p=(w=s.dimStats)==null||(m=w.minValues)==null?void 0:m[s.dimCount-1],v=(b=s.dimStats)==null||(d=b.maxValues)==null?void 0:d[s.dimCount-1];p!=null&&v!=null&&(s.minValue=p,s.maxValue=v)}if(a++,o.addData({pixels:s.pixelData,statistics:{minValue:s.minValue,maxValue:s.maxValue}}),i-f>10){const p=String.fromCharCode.apply(null,new Uint8Array(e,f,10));f+=p.indexOf("Lerc")>-1?p.indexOf("Lerc"):0}}let g=0,T=0,S=0;if(h>1){for(S=o.width*o.height,r=new Uint8Array(S),r.set(l[0]),g=1;g<l.length;g++){const p=l[g];for(T=0;T<S;T++)r[T]=r[T]&p[T]}for(n=0,T=0;T<S;T++)n+=r[T];o.mask=r}return o.validPixelCount=n,o}function xr(e,t){const r=Cr(e,t.pyramidLevel||0),s=new le({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return s.updateStatistics(),s}function Ar(e,t){const r=wr(e,t.customOptions),s=new le({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return s.updateStatistics(),s}function Pt(e,t){const r=t.pixelType||"u8",s=le.getPixelArrayConstructor(r),o=r==="u8"?e:new s(e.buffer),a=[],f=t.planes||1;if(f===1)a.push(o);else for(let i=0;i<f;i++){const l=(t.width||1)*(t.height||e.length),u=new s(l);for(let c=0;c<l;c++)u[c]=o[c*f+i];a.push(u)}const n=new le({width:t.width||1,height:t.height||e.length,pixels:a,pixelType:r,statistics:null});return n.updateStatistics(),n}function Dr(e,t){return Pt(new ve(new Uint8Array(e)).getBytes(),t)}function Pr(e,t){return Pt(Ke(e,t.offset,t.eof,!t.isInputBigEndian),t)}function Lr(e,t,r){const{pixelTypeCtor:s}=Et(t.pixelType),o=(0,br.decode)(e,{width:t.width,height:t.height,pixelType:s,format:r}),a=new le({width:t.width,height:t.height,pixels:o.pixels,pixelType:t.pixelType,mask:o.mask,statistics:null});return a.updateStatistics(),a}function Er(e){const t=Qt.decode(e),r=new le({width:t.width,height:t.height,pixels:t.pixels,pixelType:"U8",mask:t.mask,statistics:null});return r.updateStatistics(),r}function Rr(e,t){const r=new Uint8Array(e),s=new Tr(r),{width:o,height:a}=t,f=o*a,n=s.decode();let i,l=0,u=0;const c=new Uint8Array(f);for(l=0;l<f;l++)c[l]=n[4*l+3];const h=new le({width:o,height:a,pixels:[],pixelType:"U8",mask:c,statistics:[]});for(l=0;l<3;l++){for(i=new Uint8Array(f),u=0;u<f;u++)i[u]=n[4*u+l];h.addData({pixels:i})}return h.updateStatistics(),h}async function Ur(e,t,r,s){const o=new Ye,a=ne({applyJpegMask:!1,format:t},r),f=await o.decode(e,a,s),n=new le(f);return n.updateStatistics(),n}function Lt(e){if(e==null)throw new ce("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().indexOf("error")>-1&&(r="error"),r}function Mr(e){let t=null;switch(e){case"lerc":t=kr;break;case"lerc2":t=Ir;break;case"jpg":t=Er;break;case"png":t=Rr;break;case"bsq":case"bip":t=(r,s)=>Lr(r,s,e);break;case"tiff":t=xr;break;case"deflate":t=Dr;break;case"lzw":t=Pr;break;case"error":t=()=>{throw new ce("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new ce("rasterCodec:decode","unsupported raster format")}}return t}function Et(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function Or(e,t=1){if(!e)return;const{pixels:r,width:s,height:o,mask:a}=e;if(!r||r.length===0)return;const f=r.length,n=s-1,i=o-1,l=[];let u,c,h,y,w,m,b;const d=le.getPixelArrayConstructor(e.pixelType);if(t===0){for(u=0;u<f;u++){for(w=r[u],m=new d(n*i),c=0;c<i;c++)for(y=c*s,h=0;h<n;h++)m[c*n+h]=w[y+h];l.push(m)}if(a)for(b=new Uint8Array(n*i),c=0;c<i;c++)for(y=c*s,h=0;h<n;h++)b[c*n+h]=a[y+h]}else{for(u=0;u<f;u++){for(w=r[u],m=new d(n*i),c=0;c<i;c++)for(y=c*s,h=0;h<n;h++)m[c*n+h]=(w[y+h]+w[y+h+1]+w[y+s+h]+w[y+s+h+1])/4;l.push(m)}if(a)for(b=new Uint8Array(n*i),c=0;c<i;c++)for(y=c*s,h=0;h<n;h++)b[c*n+h]=Math.min.apply(null,[a[y+h],a[y+h+1],a[y+s+h],a[y+s+h+1]])}e.width=n,e.height=i,e.mask=b,e.pixels=l}function Zr(e){let t=Lt(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Qr(e,t={},r){if(e==null)throw new ce("rasterCodec:decode","missing encodeddata parameter.");let s,o,a=t.format&&t.format.toLowerCase();if(!(a!=="bsq"&&a!=="bip"||t.width!=null&&t.height!=null))throw new ce("rasterCodec:decode","requires width and height in options parameter.");return a==="tiff"&&t.customOptions?Ar(e,t):((!a||a!=="bsq"&&a!=="bip"&&a!=="deflate"&&a!=="lzw")&&(a=Lt(e)),t.useCanvas&&Sr.has(a)?o=await Ur(e,a,t,r):(s=Mr(a),t.isPoint&&((t=ne({},t)).width++,t.height++),o=s(e,t),t.isPoint&&Or(o)),o)}let te=class extends Fe{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.blockBoundary=null}};F([j({type:Number,json:{write:!0}})],te.prototype,"blockWidth",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"blockHeight",void 0),F([j({type:String,json:{write:!0}})],te.prototype,"compression",void 0),F([j({type:Yt,json:{write:!0}})],te.prototype,"origin",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"firstPyramidLevel",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"maximumPyramidLevel",void 0),F([j({json:{write:!0}})],te.prototype,"pyramidResolutions",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"pyramidScalingFactor",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"pyramidBlockWidth",void 0),F([j({type:Number,json:{write:!0}})],te.prototype,"pyramidBlockHeight",void 0),F([j({type:Boolean,json:{write:!0}})],te.prototype,"isVirtualTileInfo",void 0),F([j({json:{write:!0}})],te.prototype,"tileInfo",void 0),F([j()],te.prototype,"blockBoundary",void 0),te=F([Ve("esri.layers.support.RasterStorageInfo")],te);const Br=te;let q=class extends Fe{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get dataType(){var e,t,r;const s=(e=(t=this.keyProperties)==null||(r=t.DataType)==null?void 0:r.toLowerCase())!=null?e:"generic";return s==="stdtime"?"standard-time":s}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(!oe(this.transform)||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}};F([j({json:{write:!0}})],q.prototype,"attributeTable",void 0),F([j({json:{write:!0}})],q.prototype,"bandCount",void 0),F([j({json:{write:!0}})],q.prototype,"colormap",void 0),F([j({type:String,readOnly:!0})],q.prototype,"dataType",null),F([j({type:ot,json:{write:!0}})],q.prototype,"extent",void 0),F([j({type:ot,json:{write:!0}})],q.prototype,"nativeExtent",null),F([j({json:{write:!0}})],q.prototype,"nativePixelSize",null),F([j({json:{write:!0}})],q.prototype,"format",void 0),F([j({json:{write:!0}})],q.prototype,"height",void 0),F([j({json:{write:!0}})],q.prototype,"width",void 0),F([j({json:{write:!0}})],q.prototype,"histograms",void 0),F([j({json:{write:!0}})],q.prototype,"keyProperties",void 0),F([j({json:{write:!0}})],q.prototype,"multidimensionalInfo",void 0),F([j()],q.prototype,"noDataValue",void 0),F([j({json:{write:!0}})],q.prototype,"pixelSize",void 0),F([j({json:{write:!0}})],q.prototype,"pixelType",void 0),F([j()],q.prototype,"isPseudoSpatialReference",void 0),F([j({type:Kt,json:{write:!0}})],q.prototype,"spatialReference",void 0),F([j({json:{write:!0}})],q.prototype,"statistics",void 0),F([j({type:Br,json:{write:!0}})],q.prototype,"storageInfo",void 0),F([j({json:{write:!0}})],q.prototype,"transform",void 0),q=F([Ve("esri.layers.support.RasterInfo")],q);const Gr=q;function Rt(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:s,pixelSizePower:o,pixelSizeFactor:a,scalingType:f,isGCS:n,resolution:i}=e,l=s==="multi-directional"?2*e.zFactor:e.zFactor,{x:u,y:c}=i;let h=l/(8*u),y=l/(8*c);if(n&&l>.001&&(h/=111e3,y/=111e3),f==="adjusted")if(n){const L=111e3*u,A=111e3*c;h=(l+L**o*a)/(8*L),y=(l+A**o*a)/(8*A)}else h=(l+u**o*a)/(8*u),y=(l+c**o*a)/(8*c);let w=(90-t)*Math.PI/180,m=Math.cos(w),b=(360-r+90)*Math.PI/180,d=Math.sin(w)*Math.cos(b),g=Math.sin(w)*Math.sin(b);const T=[315,270,225,360,180,0],S=[60,60,60,60,60,90],p=new Float32Array([3,5,3,2,1,4]),v=p.reduce((L,A)=>L+A),C=p.map(L=>L/v),k=s==="multi-directional"?T.length:1,I=new Float32Array(6),P=new Float32Array(6),x=new Float32Array(6);if(s==="multi-directional")for(let L=0;L<k;L++)t=S[L],r=T[L],w=(90-t)*Math.PI/180,m=Math.cos(w),b=(360-r+90)*Math.PI/180,d=Math.sin(w)*Math.cos(b),g=Math.sin(w)*Math.sin(b),I[L]=m,P[L]=d,x[L]=g;else I.fill(m),P.fill(d),x.fill(g);return{resolution:i,factor:[h,y],sinZcosA:d,sinZsinA:g,cosZ:m,sinZcosAs:P,sinZsinAs:x,cosZs:I,weights:C,hillshadeType:["traditional","multi-directional"].indexOf(s)}}function _r(e,t){if(!Ue(e))return e;const{width:r,height:s,mask:o}=e,a=new Uint8Array(r*s);o&&a.set(o);const{factor:f,sinZcosA:n,sinZsinA:i,cosZ:l,sinZcosAs:u,sinZsinAs:c,cosZs:h,weights:y}=Rt(t),[w,m]=f,{hillshadeType:b}=t,d=e.pixels[0],g=new Uint8Array(r*s);let T,S,p,v,C,k,I,P;const x=1;for(let L=x;L<s-x;L++){const A=L*r;for(let D=x;D<r-x;D++){if(o&&!o[A+D]){g[A+D]=0;continue}let M=8;if(o&&(M=o[A-r+D-1]+o[A-r+D]+o[A-r+D+1]+o[A+D-1]+o[A+D+1]+o[A+r+D-1]+o[A+r+D]+o[A+r+D+1],M<7)){g[A+D]=0,a[A+D]=0;continue}M===7?(T=o[A-r+D-1]?d[A-r+D-1]:d[A+D],S=o[A-r+D]?d[A-r+D]:d[A+D],p=o[A-r+D+1]?d[A-r+D+1]:d[A+D],v=o[A+D-1]?d[A+D-1]:d[A+D],C=o[A+D+1]?d[A+D+1]:d[A+D],k=o[A+r+D-1]?d[A+r+D-1]:d[A+D],I=o[A+r+D]?d[A+r+D]:d[A+D],P=o[A+r+D+1]?d[A+r+D+1]:d[A+D]):(T=d[A-r+D-1],S=d[A-r+D],p=d[A-r+D+1],v=d[A+D-1],C=d[A+D+1],k=d[A+r+D-1],I=d[A+r+D],P=d[A+r+D+1]);const E=(p+C+C+P-(T+v+v+k))*w,R=(k+I+I+P-(T+S+S+p))*m,N=Math.sqrt(1+E*E+R*R);let z=0;if(b==="traditional"){let U=255*(l+i*R-n*E)/N;U<0&&(U=0),z=U}else{const U=c.length;for(let O=0;O<U;O++){let G=255*(h[O]+c[O]*R-u[O]*E)/N;G<0&&(G=0),z+=G*y[O]}}g[A+D]=255&z}}for(let L=0;L<s;L++)g[L*r]=g[L*r+1],g[(L+1)*r-1]=g[(L+1)*r-2];for(let L=1;L<r-1;L++)g[L]=g[L+r],g[L+(s-1)*r]=g[L+(s-2)*r];return new le({width:r,height:s,pixels:[g],mask:o?a:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function Nr(e,t,r,s){if(!Ue(e)||!Ue(t))return;const{min:o,max:a}=s,f=e.pixels[0],{pixels:n,mask:i}=t,l=n[0],u=255.00001/(a-o),c=new Uint8ClampedArray(l.length),h=new Uint8ClampedArray(l.length),y=new Uint8ClampedArray(l.length),w=r.length-1;for(let m=0;m<l.length;m++){if(i&&i[m]===0)continue;const b=Math.floor((l[m]-o)*u),[d,g]=r[b<0?0:b>w?w:b],T=f[m],S=T*g,p=S*(1-Math.abs(d%2-1)),v=T-S;switch(Math.floor(d)){case 0:c[m]=S+v,h[m]=p+v,y[m]=v;break;case 1:c[m]=p+v,h[m]=S+v,y[m]=v;break;case 2:c[m]=v,h[m]=S+v,y[m]=p+v;break;case 3:c[m]=v,h[m]=p+v,y[m]=S+v;break;case 4:c[m]=p+v,h[m]=v,y[m]=S+v;break;case 5:case 6:c[m]=S+v,h[m]=v,y[m]=p+v}}e.pixels=[c,h,y],e.updateStatistics()}const Vr=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],Fr={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};function Ne(e,t){if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]>t[r]+2||e[r]<t[r]-2)return!1;return!0}function $r(e,t,r){const s=ft(e),o=ft(t),a={l:s.l*(1-r)+r*o.l,a:s.a*(1-r)+r*o.a,b:s.b*(1-r)+r*o.b};return Xt(a)}function jr(e,t){if(!e)return;const r=t||Vr;let s,o=null;return e.type==="algorithmic"?r.some(a=>{if(Ne(e.fromColor.toRgb(),a.fromColor)&&Ne(e.toColor.toRgb(),a.toColor))return o=a.id,!0}):e.type==="multipart"&&r.some(a=>{if(e.colorRamps&&a.colorRamps&&e.colorRamps.length===a.colorRamps.length&&(s=e.colorRamps,!a.colorRamps.some((f,n)=>{if(!Ne(s[n].fromColor.toRgb(),new it(f.fromColor).toRgb())||!Ne(s[n].toColor.toRgb(),new it(f.toColor).toRgb()))return!0}))){if(o)return!0;o=a.id}}),o}function eo(e){const t=jr(e);return t?Fr[t]:null}function Ut(e,t,r=!1){if(!e||!t||t<1)return;const s="toJSON"in e?e.toJSON():e,o=s.type==="multipart"?s.colorRamps.length:1,a=[],f=[];let n,i,l,u,c,h=0;if(t===1)return n=s.type==="multipart"?s.colorRamps[0].fromColor:s.fromColor,f.push([0].concat(n)),f;for(let y=0;y<o;y++)a[y]={start:null,end:null},a[y].start=h,a[y].end=h+1/o,h=a[y].end;for(let y=0;y<t;y++)u=y/(t-1),a.forEach((w,m)=>{if(u>=w.start&&(u<w.end||y===t-1&&m===o-1)){c=(u-w.start)/(w.end-w.start),s.type==="multipart"?(n=s.colorRamps[m].fromColor,i=s.colorRamps[m].toColor):(n=s.fromColor,i=s.toColor),y===0?f.push([y].concat(n.slice(0,3))):y===t-1?f.push([y].concat(i.slice(0,3))):(l=$r({r:n[0],g:n[1],b:n[2]},{r:i[0],g:i[1],b:i[2]},c),f.push([y,l.r,l.g,l.b]));const b=n[3]!=null?n[3]>1?n[3]/255:n[3]:1,d=i[3]!=null?i[3]>1?i[3]/255:i[3]:1;r&&f[y].push(Math.min(255,Math.round(255*(b*(1-c)+d*c))))}});return f}const Mt=Wt.getLogger("esri.renderers.support.RasterSymbolizer");function zr(e,t){const{attributeTable:r,bandCount:s}=e;return!(!oe(r)||s>1||t&&r.fields.find(o=>o.name.toLowerCase()===t.toLowerCase())==null)}function Yr(e){return e.dataType==="elevation"}function Kr(e){const{bandCount:t,colormap:r}=e;return oe(r)&&r.length&&t===1}const Ot={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};let Te=class extends Fe{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t={success:this._updateUVRenderer(e)};break;case"rasterColormap":t={success:this._updateColormapRenderer(e)};break;case"rasterStretch":t={success:this._updateStretchRenderer(e)};break;case"classBreaks":t={success:this._updateClassBreaksRenderer(e)};break;case"rasterShadedRelief":t={success:this._updateShadedReliefRenderer(e)};break;case"vectorField":t={success:this._updateVectorFieldRenderer()};break;case"animatedFlow":t=this._updateAnimatedFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!Bt(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=nt(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolize_colormap(t);break;case"classBreaks":r=this._symbolize_classBreaks(t);break;case"rasterStretch":r=this._symbolize_stretch(t,e.bandIds);break;case"rasterShadedRelief":{const{extent:s}=e,o=s.spatialReference.isGeographic,a={x:(s.xmax-s.xmin)/t.width,y:(s.ymax-s.ymin)/t.height};r=this._symbolize_shadedRelief(t,{isGCS:o,resolution:a});break}}return r}catch(r){return Mt.error("symbolize",r.message),t}}simpleStretch(e,t){if(!Bt(e))return e;try{return e.pixels.length>3&&(e=nt(e,[0,1,2])),$e(e,t)}catch(r){return Mt.error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].indexOf(this.rendererJSON.type)>-1){var t;const{indexedColormap:n,offset:i}=((t=this.lookup)==null?void 0:t.colormapLut)||{};return{colormap:n,colormapOffset:i,type:"lut"}}const{pixelBlock:r,isGCS:s,resolution:o,bandIds:a}=e,{rendererJSON:f}=this;return f.type==="rasterStretch"?this.generateStretchWebGLParams(r,f,a):f.type==="rasterShadedRelief"?this.generateShadedReliefWebGLParams(f,s,o):f.type==="vectorField"?this._generateVectorFieldWebGLParams(f):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolize_colormap(e){return this._isLUTChanged()&&!this.bind().success?e:je(e,this.lookup.colormapLut)}_symbolize_classBreaks(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1;return this._isLUTChanged()&&!this.bind().success?e:r?je(e,this.lookup.colormapLut):Ht(e,this.lookup.remapLut)}_symbolize_stretch(e,t){const{pixelType:r,bandCount:s}=this.rasterInfo,o=this.rendererJSON,a=["u8","u16","s8","s16"].indexOf(r)>-1;let f,n;const{dra:i}=o,l=o.useGamma?o.gamma:null;if(o.stretchType==="histogramEqualization"){const h=i?null:this.lookup.histogramLut,y=this.getStretchCutoff(o,e,t,!h),w=$e(e,pe(ne({},y),{gamma:l}));n=at(w,{lut:i?y.histogramLut:h,offset:0})}else if(a){var u,c;if(i){const h=this.getStretchCutoff(o,e,t);f=st(pe(ne({pixelType:r},h),{gamma:l}))}else if(this._isLUTChanged()){if(!this.bind().success)return e;f=this.lookup?this.lookup.stretchLut:null}else f=this.lookup?this.lookup.stretchLut:null;if(!f)return e;s>1&&(t==null?void 0:t.length)===((u=ke(e))==null?void 0:u.pixels.length)&&((c=f)==null?void 0:c.lut.length)===s&&(f={lut:t.map(h=>f.lut[h]),offset:f.offset}),n=at(e,f)}else{const h=this.getStretchCutoff(o,e,t);n=$e(e,pe(ne({},h),{gamma:l}))}if(o.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;n=je(n,this.lookup.colormapLut)}return n}_symbolize_shadedRelief(e,t){var r,s;const o=this.rendererJSON,a=ne(ne({},o),t),f=_r(e,a);if(!o.colorRamp)return f;let n;if(this._isLUTChanged(!0)){if(!this.bind().success)return f;n=this.lookup?this.lookup.hsvMap:null}else n=this.lookup?this.lookup.hsvMap:null;if(!n)return f;const i=(r=(s=ke(this.rasterInfo.statistics))==null?void 0:s[0])!=null?r:{min:0,max:8e3};return Nr(f,e,n,i),f}_updateVectorFieldRenderer(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateAnimatedFlowRenderer(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")?{success:!0}:{success:!1,error:`Unsupported data type "${t}"; AnimatedFlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:r,pixelType:s}=this.rasterInfo,o=e.field1;if(!o)return!1;const a=e.defaultSymbol,f=t===1&&["u8","s8"].includes(s);if(!zr(this.rasterInfo,o)&&!f)return!1;const n=[];if(r){const l=r.fields.filter(u=>u.name.toLowerCase()==="value")[0];if(!l)return!1;r.features.forEach(u=>{var c;const h=e.uniqueValueInfos.filter(w=>String(w.value)===String(u.attributes[o]))[0],y=h==null||(c=h.symbol)==null?void 0:c.color;y?n.push([u.attributes[l.name]].concat(y)):a&&n.push([u.attributes[l.name]].concat(a.color))})}else{if(o.toLowerCase()!=="value")return!1;e.uniqueValueInfos.forEach(l=>{var u;const c=l==null||(u=l.symbol)==null?void 0:u.color;c?n.push([parseInt(""+l.value,10)].concat(c)):a&&n.push([parseInt(""+l.value,10)].concat(a.color))})}if(n.length===0)return!1;const i=Pe({colormap:n});return this.lookup={rendererJSON:e,colormapLut:i},this.canRenderInWebGL=!0,!0}_updateColormapRenderer(e){if(!Kr(this.rasterInfo))return!1;const t=e.colormapInfos.map(s=>[s.value].concat(s.color)).sort((s,o)=>s[0]-o[0]);if(!t||t.length===0)return!1;const r=Pe({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,!0}_updateShadedReliefRenderer(e){if(!Yr(this.rasterInfo))return!1;if(e.colorRamp){const t=Ut(e.colorRamp,256,!0),r=Pe({colormap:t}),s=[],o=r.indexedColormap;for(let a=0;a<o.length;a+=4){const f=Zt({r:o[a],g:o[a+1],b:o[a+2]});s.push([f.h/60,f.s/100,255*f.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:s}}else this.lookup=null;return this.canRenderInWebGL=!0,!0}_updateClassBreaksRenderer(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1,s=e.classBreakInfos;if(s==null||!s.length)return!1;const o=s.sort((u,c)=>u.classMaxValue-c.classMaxValue),a=o[o.length-1];let f=e.minValue;if(!r){const u=[];for(let c=0;c<o.length;c++){var n;u.push({value:(n=o[c].classMinValue)!=null?n:f,mappedColor:o[c].symbol.color}),f=o[c].classMaxValue}return u.push({value:a.classMaxValue,mappedColor:a.symbol.color}),this.lookup={rendererJSON:e,remapLut:u},this.canRenderInWebGL=!1,!0}const i=[];f=Math.floor(e.minValue);for(let u=0;u<o.length;u++){const c=o[u];for(let h=f;h<c.classMaxValue;h++)i.push([h].concat(c.symbol.color));f=Math.ceil(c.classMaxValue)}a.classMaxValue===f&&i.push([a.classMaxValue].concat(a.symbol.color));const l=Pe({colormap:i,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:l},this.canRenderInWebGL=!0,!0}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return oe(e)&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var t;let{stretchType:r,dra:s}=e;if(!(r==="none"||(t=e.statistics)!=null&&t.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||s))return!1;const o=ke(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||o!=null&&o.length||s||(r="minMax");const{gamma:a,useGamma:f,colorRamp:n}=e,i=this.rasterInfo.pixelType,l=!s&&["u8","u16","s8","s16"].indexOf(i)>-1;if(r==="histogramEqualization"){const u=o.map(c=>lt(c));this.lookup={rendererJSON:e,histogramLut:u}}else if(l){const u=this.getStretchCutoff(e),c=st(pe(ne({pixelType:i},u),{gamma:f?a:null}));this.lookup={rendererJSON:e,stretchLut:c}}if(n){const u=Ut(n,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Pe({colormap:u}),this.lookup.rendererJSON=e}return this.canRenderInWebGL=!0,!0}getStretchCutoff(e,t=null,r,s){var o,a,f;let n,i,l=e.stretchType;var u;if(e.dra)if(l==="minMax"&&oe(t)&&t.statistics)n=t.statistics.map(x=>[x.minValue,x.maxValue,0,0]);else{const x=Jt(t);n=oe(x)?x.statistics:null,i=oe(x)?x.histograms:null}else n=((u=e.statistics)==null?void 0:u.length)>0?e.statistics:ke(this.rasterInfo.statistics),i=e.histograms||ke(this.rasterInfo.histograms);!this._isHistogramRequired(l)||(o=i)!=null&&o.length||(l="minMax");const c=((a=n)==null?void 0:a.length)||((f=i)==null?void 0:f.length)||this.rasterInfo.bandCount,h=[],y=[];let w,m,b,d,g,T,S,p,v,C,k,I;switch(n&&!Array.isArray(n[0])&&(n=n.map(x=>[x.min,x.max,x.avg,x.stddev])),l){case"none":{const x=Ot[this.rasterInfo.pixelType]||Ot.f32;for(p=0;p<c;p++)h[p]=x[0],y[p]=x[1]}break;case"minMax":for(p=0;p<c;p++)h[p]=n[p][0],y[p]=n[p][1];break;case"standardDeviation":for(p=0;p<c;p++)h[p]=n[p][2]-e.numberOfStandardDeviations*n[p][3],y[p]=n[p][2]+e.numberOfStandardDeviations*n[p][3],h[p]<n[p][0]&&(h[p]=n[p][0]),y[p]>n[p][1]&&(y[p]=n[p][1]);break;case"histogramEqualization":for(p=0;p<c;p++)h[p]=i[p].min,y[p]=i[p].max;break;case"percentClip":for(p=0;p<i.length;p++){for(w=i[p],g=new Uint32Array(w.size),d=w.counts,b=0,m=(w.max-w.min)/w.size,S=w.min===-.5&&m===1?.5:0,v=0;v<w.size;v++)b+=d[v],g[v]=b;for(T=(e.minPercent||0)*b/100,v=0;v<w.size;v++)if(g[v]>T){h[p]=w.min+m*(v+S);break}for(T=(1-(e.maxPercent||0)/100)*b,v=w.size-2;v>=0;v--)if(g[v]<T){y[p]=w.min+m*(v+2-S);break}}break;default:for(p=0;p<c;p++)h[p]=n[p][0],y[p]=n[p][1]}l==="histogramEqualization"?(k=i[0].size||256,C=0,s&&(I=i.map(x=>lt(x)))):(k=e.max||255,C=e.min||0);const P={minCutOff:h,maxCutOff:y,outMax:k,outMin:C,histogramLut:I};return this.getSelectedBandCutoffs(P,r)}getSelectedBandCutoffs(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:s,maxCutOff:o,outMin:a,outMax:f,histogramLut:n}=e;return s.length===t.length||s.length<=r?e:{minCutOff:t.map(i=>s[i]),maxCutOff:t.map(i=>o[i]),histogramLut:n?t.map(i=>n[i]):null,outMin:a,outMax:f}}generateStretchWebGLParams(e,t,r){let s=null,o=null;const a=this.lookup&&this.lookup.colormapLut;t.colorRamp&&a&&(s=a.indexedColormap,o=a.offset),t.stretchType==="histogramEqualization"&&(t=pe(ne({},t),{stretchType:"minMax"}));const{gamma:f}=t,n=!!(t.useGamma&&f&&f.some(g=>g!==1)),{minCutOff:i,maxCutOff:l,outMin:u,outMax:c}=this.getStretchCutoff(t,e,r);let h=0;oe(e)&&(h=e.getPlaneCount(),h===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const y=Math.min(3,(r==null?void 0:r.length)||h||this.rasterInfo.bandCount),w=new Float32Array(y),m=s||n?1:255;let b;for(b=0;b<y;b++)w[b]=(c-u)/(l[b]-i[b])/m;const d=new Float32Array(y);if(n)for(b=0;b<y;b++)f[b]>1?f[b]>2?d[b]=6.5+(f[b]-2)**2.5:d[b]=6.5+100*(2-f[b])**4:d[b]=1;return{bandCount:y,outMin:u/m,outMax:c/m,minCutOff:i,maxCutOff:l,factor:w,useGamma:n,gamma:n?f:[1,1,1],gammaCorrection:n?d:[1,1,1],colormap:s,colormapOffset:o,stretchType:t.stretchType,type:"stretch"}}generateShadedReliefWebGLParams(e,t,r){var s,o,a;let f=null,n=null;const i=this.lookup&&this.lookup.colormapLut;e.colorRamp&&i&&(f=i.indexedColormap,n=i.offset);const l=pe(ne({},e),{isGCS:t,resolution:r}),u=Rt(l),c=(s=ke(this.rasterInfo.statistics))==null?void 0:s[0];return pe(ne({},u),{minValue:(o=c==null?void 0:c.min)!=null?o:0,maxValue:(a=c==null?void 0:c.max)!=null?a:8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:f,colormapOffset:n})}_generateVectorFieldWebGLParams(e){var t,r,s,o,a,f;const{style:n,inputUnit:i,outputUnit:l,visualVariables:u,symbolTileSize:c,flowRepresentation:h}=e;let y;const w=(t=u==null?void 0:u.find(p=>p.type==="sizeInfo"))!=null?t:{type:"sizeInfo",field:"Magnitude",maxDataValue:(r=this.rasterInfo.statistics)==null?void 0:r[0].max,maxSize:.8*c,minDataValue:(s=this.rasterInfo.statistics)==null?void 0:s[0].min,minSize:.2*c},m=w?w.minDataValue:(o=this.rasterInfo.statistics)==null?void 0:o[0].min,b=w?w.maxDataValue:(a=this.rasterInfo.statistics)==null?void 0:a[0].max,d=oe(w.maxSize)&&oe(w.minSize)?[w.minSize/c,w.maxSize/c]:[.2,.8];if(n==="wind_speed"||n==="simple_scalar"){const p=(d[0]+d[1])/2;d[0]=d[1]=p}const g=oe(m)&&oe(b)?[m,b]:null;if(n==="classified_arrow")if(oe(m)&&oe(b)&&oe(w)){y=[];const p=(w.maxDataValue-w.minDataValue)/5;for(let v=0;v<6;v++)y.push(w.minDataValue+p*v)}else y=[0,1e-6,3.5,7,10.5,14];const T=h==="flow_to"==(n==="ocean_current_kn"||n==="ocean_current_m")?0:Math.PI,S=u==null?void 0:u.find(p=>p.type==="rotationInfo");return{breakValues:y,dataRange:g,inputUnit:i,outputUnit:l,symbolTileSize:c,symbolPercentRange:d,style:n||"single_arrow",rotation:T,rotationType:((f=this.rasterInfo.storageInfo)==null?void 0:f.tileInfo)&&this.rasterInfo.dataType==="vector-uv"?"geographic":(S==null?void 0:S.rotationType)||e.rotationType,type:"vectorField"}}};function Bt(e){return Ue(e)&&e.validPixelCount!==0}F([j({json:{write:!0}})],Te.prototype,"rendererJSON",void 0),F([j({type:Gr,json:{write:!0}})],Te.prototype,"rasterInfo",void 0),F([j({json:{write:!0}})],Te.prototype,"lookup",void 0),F([j()],Te.prototype,"canRenderInWebGL",void 0),Te=F([Ve("esri.renderers.support.RasterSymbolizer")],Te);const to=Te;export{gr as C,dr as D,to as N,Zr as O,Qr as P,Vr as a,Oe as b,Ze as c,xe as d,yr as e,Ut as f,Qe as g,Gr as l,eo as n,Br as p,er as r};
