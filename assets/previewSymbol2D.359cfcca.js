import{wG as M,cc as v,wH as T,wI as Z,wJ as A,aD as B,wK as C,wL as H,l as F,wM as j,wN as R,e1 as U}from"./index.a33ecea7.js";import{n as V}from"./fontUtils.401be2b9.js";const q="picture-fill",W="picture-marker",G="simple-fill",I="simple-line",J="simple-marker",K="text",N="Aa",Q=M.size,x=M.maxSize,X=M.maxOutlineSize,Y=M.lineWidth,D=225,_=document.createElement("canvas");function O(a,e){const n=_.getContext("2d"),s=[];return e&&(e.weight&&s.push(e.weight),e.size&&s.push(e.size+"px"),e.family&&s.push(e.family)),n.font=s.join(" "),n.measureText(a).width}const $=7.2/2.54,ee=72/2.54;function ae(a){if(a.length===0)return 0;if(a.length>2){const e=U(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*$*e;case"cm":return n*ee*e}}return parseFloat(a)}function k(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function ne(a,e){const n=e.fill,s=a.color;if((n==null?void 0:n.type)==="pattern"&&s&&a.type!==q){const h=await R(n.src,s.toCss(!0));n.src=h,e.fill=n}}async function se(a,e,n,s){var p,c,o;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await V(a.font)}catch{}const{width:h}=k(s),m=/[\uE600-\uE6FF]/.test(e.shape.text);h!=null||m||(n[0]=O(e.shape.text,{weight:(p=e.font)==null?void 0:p.weight,size:(c=e.font)==null?void 0:c.size,family:(o=e.font)==null?void 0:o.family}))}function E(a,e){return a>e?"dark":"light"}function le(a,e){var z;const n=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,s=n!=null?v(n):null,h=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null,m=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,p=T(a);let c=Z(a);ie(a,245)!=="dark"||(e==null?void 0:e.ignoreWhiteSymbols)||(c={width:.75,...c,color:"#bdc3c7"});const o={shape:null,fill:p,stroke:c,offset:[0,0]};c!=null&&c.width&&(c.width=Math.min(c.width,X));const d=(c==null?void 0:c.width)||0;let g=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),l=0,i=0,b=!1;switch(a.type){case J:{const r=a.style,{width:u,height:t}=k(e),y=u===t&&u!=null?u:s!=null?s:Math.min(v(a.size),h||x);switch(l=y,i=y,r){case"circle":o.shape={type:"circle",cx:0,cy:0,r:.5*y},g||(l+=d,i+=d);break;case"cross":o.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[l,.5*i]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,i]}]};break;case"diamond":o.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*i]},{command:"L",values:[.5*l,i]},{command:"Z",values:[]}]},g||(l+=d,i+=d);break;case"square":o.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(l+=d,i+=d),m&&(b=!0);break;case"triangle":o.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(l+=d,i+=d),m&&(b=!0);break;case"x":o.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,i]},{command:"M",values:[l,0]},{command:"L",values:[0,i]}]},m&&(b=!0);break;case"path":o.shape={type:"path",path:a.path||""},g||(l+=d,i+=d),m&&(b=!0),g=!0}break}case I:{const{width:r,height:u}=k(e),t=u!=null?u:s!=null?s:d,y=r!=null?r:Y;c&&(c.width=t),l=y,i=t;const w=((z=o==null?void 0:o.stroke)==null?void 0:z.cap)||"butt",f=w==="round";g=!0,o.stroke&&(o.stroke.cap=w==="butt"?"square":w),o.shape={type:"path",path:[{command:"M",values:[f?t/2:0,i/2]},{command:"L",values:[f?l-t/2:l,i/2]}]};break}case q:case G:{const r=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:u,height:t}=k(e);l=!r&&u!==t||u==null?s!=null?s:Q:u,i=!r&&u!==t||t==null?l:t,g||(l+=d,i+=d),g=!0,o.shape=r?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:A.fill[0];break}case W:{const r=Math.min(v(a.width),h||x),u=Math.min(v(a.height),h||x),{width:t,height:y}=k(e),w=t===y&&t!=null?t:s!=null?s:Math.max(r,u),f=r/u;l=f<=1?Math.ceil(w*f):w,i=f<=1?w:Math.ceil(w/f),o.shape={type:"image",x:-Math.round(l/2),y:-Math.round(i/2),width:l,height:i,src:a.url||""},m&&(b=!0);break}case K:{const r=a,u=(e==null?void 0:e.overrideText)||r.text||N,t=r.font,{width:y,height:w}=k(e),f=w!=null?w:s!=null?s:Math.min(v(t.size),h||x),P=O(u,{weight:t.weight,size:f,family:t.family}),L=/[\uE600-\uE6FF]/.test(u);l=y!=null?y:L?f:P,i=f;let S=.25*ae((t?f:0).toString());L&&(S+=5),o.shape={type:"text",text:u,x:r.xoffset||0,y:r.yoffset||S,align:"middle",alignBaseline:r.verticalAlignment,decoration:t&&t.decoration,rotated:r.rotated,kerning:r.kerning},o.font=t&&{size:f,style:t.style,decoration:t.decoration,weight:t.weight,family:t.family};break}}return{shapeDescriptor:o,size:[l,i],renderOptions:{node:e==null?void 0:e.node,scale:g,opacity:e==null?void 0:e.opacity,rotation:m,useRotationSize:b,effectView:e==null?void 0:e.effectView}}}async function ce(a,e){const{shapeDescriptor:n,size:s,renderOptions:h}=le(a,e);if(!n.shape)throw new B("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ne(a,n),await se(a,n,s,e);const m=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.applyColorModulation)){const p=.6*s[0];m.unshift([{...n,offset:[-p,0],fill:C(n.fill,-.3)}]),m.push([{...n,offset:[p,0],fill:C(n.fill,.3)}]),s[0]+=2*p,h.scale=!1}return H(m,s,h)}function ie(a,e=D){const n=T(a),s=Z(a),h=!n||"type"in n?null:new F(n),m=s!=null&&s.color?new F(s==null?void 0:s.color):null,p=h?E(j(h),e):null,c=m?E(j(m),e):null;return c?p?p===c?p:e>=D?"light":"dark":c:p}export{ie as getContrastingBackgroundTheme,le as getRenderSymbolParameters,ce as previewSymbol2D};
