import{V as G,l2 as c,cG as S,bw as Y,bv as N,a as z,bx as _,cF as B,p_ as H,p$ as Q,q0 as Z,bb as J,an as K,kY as D}from"./index.988b09cd.js";import{y as F,p as W}from"./colorUtils.92e1b957.js";const X="http://www.w3.org/2000/svg";let tt=0,et=0;const V=G("android"),nt=G("chrome")||V&&V>=4?"auto":"optimizeLegibility",it={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},ot=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let d={},l={};const E={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},rt=Math.PI;let at=1;function v(t,e){const n=t*(rt/180);return Math.abs(e*Math.sin(n))+Math.abs(e*Math.cos(n))}function T(t){return t.map(e=>`${e.command} ${e.values.join(" ")}`).join(" ").trim()}function st(t,e,n,i){if(t){if(t.type==="circle")return c("circle",{fill:e,"fill-rule":"evenodd",stroke:n.color,"stroke-width":n.width,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-dasharray":n.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if(t.type==="ellipse")return c("ellipse",{fill:e,"fill-rule":"evenodd",stroke:n.color,"stroke-width":n.width,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-dasharray":n.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if(t.type==="rect")return c("rect",{fill:e,"fill-rule":"evenodd",stroke:n.color,"stroke-width":n.width,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-dasharray":n.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if(t.type==="image")return c("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if(t.type==="path"){const r=typeof t.path!="string"?T(t.path):t.path;return c("path",{fill:e,"fill-rule":"evenodd",stroke:n.color,"stroke-width":n.width,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-dasharray":n.dashArray,"stroke-miterlimit":"4",d:r})}if(t.type==="text")return c("text",{fill:e,"fill-rule":"evenodd",stroke:n.color,"stroke-width":n.width,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-dasharray":n.dashArray,"stroke-miterlimit":"4","text-anchor":i.align,"text-decoration":i.decoration,kerning:i.kerning,rotate:i.rotate,"text-rendering":nt,"font-style":i.font.style,"font-variant":i.font.variant,"font-weight":i.font.weight,"font-size":i.font.size,"font-family":i.font.family,x:t.x,y:t.y},t.text)}return null}function lt(t){const e={fill:"none",pattern:null,linearGradient:null};if(t){if("type"in t&&t.type==="pattern"){const n="patternId-"+ ++tt;e.fill=`url(#${n})`,e.pattern={id:n,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&t.type==="linear"){const n="linearGradientId-"+ ++et;e.fill=`url(#${n})`,e.linearGradient={id:n,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map(i=>({offset:i.offset,color:i.color&&new z(i.color).toString()}))}}else if(t){const n=new z(t);e.fill=n.toString()}}return e}function ht(t){const e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(t.width!=null&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new z(t.color).toString()),t.style)){let n=null;if(t.style in E&&(n=E[t.style]),Array.isArray(n)){n=n.slice(0);for(let i=0;i<n.length;++i)n[i]*=t.width;if(t.cap!=="butt"){for(let i=0;i<n.length;i+=2)n[i]-=t.width,n[i]<1&&(n[i]=1);for(let i=1;i<n.length;i+=2)n[i]+=t.width}n=n.join(",")}e.dashArray=n}return e}function ct(t,e){const n={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(n.align=t.align,n.decoration=t.decoration,n.kerning=t.kerning?"auto":"0",n.rotate=t.rotated?"90":"0",n.font.style=e.style||"normal",n.font.variant=e.variant||"normal",n.font.weight=e.weight||"normal",n.font.size=e.size&&e.size.toString()||"10pt",n.font.family=e.family||"serif"),n}function ft(t){const{pattern:e,linearGradient:n}=t;if(e)return c("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},c("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(n){const i=n.stops.map((r,o)=>c("stop",{key:`${o}-stop`,offset:r.offset,"stop-color":r.color}));return c("linearGradient",{id:n.id,gradientUnits:"userSpaceOnUse",x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2},i)}return null}function C(t,e,n){return Y(t,N(t),[e,n])}function R(t,e,n,i,r){return H(t,N(t),[e,n]),t[4]=t[4]*e-i*e+i,t[5]=t[5]*n-r*n+r,t}function dt(t,e,n,i){const r=e%360*Math.PI/180;_(t,N(t),r);const o=Math.cos(r),a=Math.sin(r),h=t[4],s=t[5];return t[4]=h*o-s*a+i*a-n*o+n,t[5]=s*o+h*a-n*a-i*o+i,t}function p(t,e){d&&"left"in d?(d.left>t&&(d.left=t),d.right<t&&(d.right=t),d.top>e&&(d.top=e),d.bottom<e&&(d.bottom=e)):d={left:t,bottom:e,right:t,top:e}}function q(t){const e=t.args,n=e.length;let i;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(i=0;i<n;i+=2)p(e[i],e[i+1]);l.x=e[n-2],l.y=e[n-1];break;case"H":for(i=0;i<n;++i)p(e[i],l.y);l.x=e[n-1];break;case"V":for(i=0;i<n;++i)p(l.x,e[i]);l.y=e[n-1];break;case"m":{let r=0;for(("x"in l)||(p(l.x=e[0],l.y=e[1]),r=2),i=r;i<n;i+=2)p(l.x+=e[i],l.y+=e[i+1]);break}case"l":case"t":for(i=0;i<n;i+=2)p(l.x+=e[i],l.y+=e[i+1]);break;case"h":for(i=0;i<n;++i)p(l.x+=e[i],l.y);break;case"v":for(i=0;i<n;++i)p(l.x,l.y+=e[i]);break;case"c":for(i=0;i<n;i+=6)p(l.x+e[i],l.y+e[i+1]),p(l.x+e[i+2],l.y+e[i+3]),p(l.x+=e[i+4],l.y+=e[i+5]);break;case"s":case"q":for(i=0;i<n;i+=4)p(l.x+e[i],l.y+e[i+1]),p(l.x+=e[i+2],l.y+=e[i+3]);break;case"A":for(i=0;i<n;i+=7)p(e[i+5],e[i+6]);l.x=e[n-2],l.y=e[n-1];break;case"a":for(i=0;i<n;i+=7)p(l.x+=e[i+5],l.y+=e[i+6])}}function L(t,e,n){const i=it[t.toLowerCase()];let r;typeof i=="number"&&(i?e.length>=i&&(r={action:t,args:e.slice(0,e.length-e.length%i)},n.push(r),q(r)):(r={action:t,args:[]},n.push(r),q(r)))}function ut(t){const e=(typeof t.path!="string"?T(t.path):t.path).match(ot),n=[];if(d={},l={},!e)return null;let i="",r=[];const o=e.length;for(let h=0;h<o;++h){const s=e[h],u=parseFloat(s);isNaN(u)?(i&&L(i,r,n),r=[],i=s):r.push(u)}L(i,r,n);const a={x:0,y:0,width:0,height:0};return d&&"left"in d&&(a.x=d.left,a.y=d.top,a.width=d.right-d.left,a.height=d.bottom-d.top),a}function yt(t){const e={x:0,y:0,width:0,height:0};if(t.type==="circle")e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if(t.type==="ellipse")e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if(t.type==="image"||t.type==="rect")e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if(t.type==="path"){const n=ut(t);e.x=n.x,e.y=n.y,e.width=n.width,e.height=n.height}return e}function gt(t){const e={x:0,y:0,width:0,height:0};let n=null,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const o of t)n?(n.x=Math.min(n.x,o.x),n.y=Math.min(n.y,o.y),i=Math.max(i,o.x+o.width),r=Math.max(r,o.y+o.height)):(n=e,n.x=o.x,n.y=o.y,i=o.x+o.width,r=o.y+o.height);return n&&(n.width=i-n.x,n.height=r-n.y),n}function pt(t,e,n,i,r,o,a,h,s){let u=(a&&o?v(o,e):e)/2,x=(a&&o?v(o,n):n)/2;if(s){const m=s[0],w=s[1];u=(a&&o?v(o,m):m)/2,x=(a&&o?v(o,w):w)/2}const y=t.width+i,g=t.height+i,k=B(),f=B();let $=!1;if(r&&y!==0&&g!==0){const m=y/g,w=e>n?e:n;let b=1,I=1;isNaN(w)||(m>1?(b=w/y,I=w/m/g):(I=w/g,b=w*m/y)),S(f,f,R(k,b,I,u,x)),$=!0}const M=t.x+(y-i)/2,j=t.y+(g-i)/2;if(S(f,f,C(k,u-M,x-j)),!$&&(y>e||g>n)){const m=y/e>g/n,w=(m?e:n)/(m?y:g);S(f,f,R(k,w,w,M,j))}return o&&S(f,f,dt(k,o,M,j)),h&&S(f,f,C(k,h[0],h[1])),`matrix(${f[0]},${f[1]},${f[2]},${f[3]},${f[4]},${f[5]})`}function xt(t,e,n){const i=t==null?void 0:t.effects.find(u=>u.type==="bloom");if(!i)return null;const{strength:r,radius:o}=i,a=r>0?o:0,h=(r+a)*e,s=4*r+1;return c("filter",{id:`bloom${n}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},c("feMorphology",{operator:"dilate",radius:(r+.5*a)*(5**(e/100)*(.4+e/100)),in:"SourceGraphic",result:"dilate"}),c("feGaussianBlur",{in:"dilate",stdDeviation:h/25,result:"blur"}),c("feGaussianBlur",{in:"blur",stdDeviation:h/50,result:"intensityBlur"}),c("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},c("feFuncR",{type:"linear",slope:s}),c("feFuncG",{type:"linear",slope:s}),c("feFuncB",{type:"linear",slope:s})),c("feMerge",null,c("feMergeNode",{in:"intensityBlur"}),c("feMergeNode",{in:"intensityBrightness"}),c("feGaussianBlur",{stdDeviation:r/10})))}function mt(t,e,n,i){const r=[],o=[],a=++at,h=xt(i==null?void 0:i.effectView,e,a);let s=null;if(h){var u;const x=i==null||(u=i.effectView)==null?void 0:u.effects.find(f=>f.type==="bloom"),y=(x.strength?x.strength+x.radius/2:0)/3,g=e+e*y,k=n+n*y;s=[Math.max(g,10),Math.max(k,10)]}for(const x of t){const y=[],g=[];let k=0,f=0,$=0;for(const j of x){const{shape:m,fill:w,stroke:b,font:I,offset:A}=j;k+=b&&b.width||0;const U=lt(w),O=ht(b),P=m.type==="text"?ct(m,I):null;r.push(ft(U)),y.push(st(m,U.fill,O,P)),g.push(yt(m)),A&&(f+=A[0],$+=A[1])}const M=pt(gt(g),e,n,k,i==null?void 0:i.scale,i==null?void 0:i.rotation,i==null?void 0:i.useRotationSize,[f,$],s);o.push(c("g",{transform:M},y))}return i!=null&&i.useRotationSize&&i!=null&&i.rotation&&(e=v(i==null?void 0:i.rotation,e),n=v(i==null?void 0:i.rotation,n)),h&&(e=s[0],n=s[1]),c("svg",{xmlns:X,width:e,height:n},h,c("defs",null,r),h?c("g",{filter:`url(#bloom${a})`},o):o)}const wt=Q();function It(t,e,n){const i=Math.ceil(e[0]),r=Math.ceil(e[1]);if(!t.some(a=>!!a.length))return null;const o=n&&n.node||document.createElement("div");return n.opacity!=null&&(o.style.opacity=n.opacity.toString()),n.effectView!=null&&(o.style.filter=Z(n.effectView)),wt.append(o,mt.bind(null,t,i,r,n)),o}function kt(t,e){t=Math.ceil(t),e=Math.ceil(e);const n=document.createElement("canvas");n.width=t,n.height=e,n.style.width=t+"px",n.style.height=e+"px";const i=n.getContext("2d");return i.clearRect(0,0,t,e),i}function bt(t,e,n){return t?J(t,{responseType:"image"}).then(i=>{const r=i.data,o=r.width,a=r.height,h=o/a;let s=e;if(n){const u=Math.max(o,a);s=Math.min(s,u)}return{image:r,width:h<=1?Math.ceil(s*h):s,height:h<=1?s:Math.ceil(s/h)}}):Promise.reject(new K("renderUtils: imageDataSize","href not provided."))}function vt(t,e){return!(!t||e==="ignore")&&(e!=="multiply"||t.r!==255||t.g!==255||t.b!==255||t.a!==1)}function $t(t,e,n,i,r){switch(r){case"multiply":t[e+0]*=n[0],t[e+1]*=n[1],t[e+2]*=n[2],t[e+3]*=n[3];break;default:{const o=F({r:t[e+0],g:t[e+1],b:t[e+2]});o.h=i.h,o.s=i.s,o.v=o.v/100*i.v;const a=W(o);t[e+0]=a.r,t[e+1]=a.g,t[e+2]=a.b,t[e+3]*=n[3];break}}}function St(t,e,n,i,r){return bt(t,e,r).then(o=>{const a=o.width?o.width:e,h=o.height?o.height:e;if(o.image&&vt(n,i)){let s=o.image.width,u=o.image.height;G("edge")&&/\.svg$/i.test(t)&&(s-=1,u-=1);const x=kt(a,h);x.drawImage(o.image,0,0,s,u,0,0,a,h);const y=x.getImageData(0,0,a,h),g=[n.r/255,n.g/255,n.b/255,n.a],k=F(n);for(let f=0;f<y.data.length;f+=4)$t(y.data,f,g,k,i);x.putImageData(y,0,0),t=x.canvas.toDataURL("image/png")}else{const s=D&&D.findCredential(t);if(s&&s.token){const u=t.indexOf("?")===-1?"?":"&";t=`${t}${u}token=${s.token}`}}return{url:t,width:a,height:h}}).catch(function(){return{url:t,width:e,height:e}})}export{ht as A,mt as D,gt as E,ft as G,lt as M,yt as T,pt as V,St as d,st as j,It as l};
